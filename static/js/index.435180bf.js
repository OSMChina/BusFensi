(()=>{"use strict";var e={4637:function(e,t,n){let o;var i,a,r,s=n(5893),l=n(7294),d=n(745),c=n(1621);let u={viewpoint:{lon:-122.431297,lat:37.773972},zoom:17,drawMode:{}};var m=n(5407);let p=e=>({setViewpoint:t=>e(()=>({viewpoint:t})),setZoom:t=>e(()=>({zoom:t})),setStage:(t,n)=>e({width:t,height:n}),setStageApp:t=>e({stage:t}),setSelectionRect:t=>e({selectionRect:t}),clearDrawModeNC:()=>e({drawMode:{}}),setFromPosNC:t=>e(e=>({drawMode:{...e.drawMode,fromPos:t}})),setCurPosNC:t=>e(e=>({drawMode:{...e.drawMode,curPos:t}}))}),h=()=>new URLSearchParams(window.location.search),f=e=>{let t=e.toString();window.history.replaceState(null,"",`${location.pathname}${t?"?":""}${t}`)},x=(0,m.U)()((0,c.mW)((o=function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return{...u,...p(...t)}},(e,t,n)=>{let i=o(e,t,n),a={},r=h(),s=r.get("lat"),l=r.get("lon"),d=r.get("zoom");s&&l&&(a.viewpoint={lat:parseFloat(s),lon:parseFloat(l)}),d&&(a.zoom=parseFloat(d));let c={...i,...a};return e(c,!0,"mapViewURLPersist/hydrate"),n.subscribe((e,t)=>{var n,o,i,a,r,s,l,d,c;let u=h(),m=!1;(null===(n=e.viewpoint)||void 0===n?void 0:n.lat)!==(null===(o=t.viewpoint)||void 0===o?void 0:o.lat)&&(u.set("lat",(null===(s=e.viewpoint)||void 0===s?void 0:null===(r=s.lat)||void 0===r?void 0:r.toString())||""),m=!0),(null===(i=e.viewpoint)||void 0===i?void 0:i.lon)!==(null===(a=t.viewpoint)||void 0===a?void 0:a.lon)&&(u.set("lon",(null===(d=e.viewpoint)||void 0===d?void 0:null===(l=d.lon)||void 0===l?void 0:l.toString())||""),m=!0),e.zoom!==t.zoom&&(u.set("zoom",(null===(c=e.zoom)||void 0===c?void 0:c.toString())||""),m=!0),m&&f(u)}),c}),{name:"MapView"}));var b=n(3399);g({lon:-122.431297,lat:37.773972});function g(e){let[t,n]=(0,b.Z)("EPSG:4326","EPSG:3857",[e.lon,e.lat]);return{x:t,y:n}}function y(e,t){let n=40075016.68/(256*Math.pow(2,t));return{x:(e.x- -20037508.34)/n,y:(20037508.34-e.y)/n}}function w(e,t,n,o,i){let a=y(g(t),n);return{x:Math.floor(e.x+(o?o/2:0)-a.x),y:Math.floor(e.y+(i?i/2:0)-a.y)}}function v(e,t,n,o,i){return w(y(g(e),n),t,n,o,i)}function _(e,t,n,o,i){let a=40075016.68/(256*Math.pow(2,n)),r=g(t),s=Math.floor(o/2),l=Math.floor(i/2),d=(e.x-s)*a,c=(e.y-l)*a;return function(e){let[t,n]=(0,b.Z)("EPSG:3857","EPSG:4326",[e.x,e.y]);return{lon:t,lat:n}}({x:r.x+d,y:r.y-c})}function j(e,t,n,o){let{lon:i,lat:a}=_({x:0,y:0},e,t,n,o),{lon:r,lat:s}=_({x:n,y:o},e,t,n,o);return{left:i,bottom:s,right:r,top:a}}function N(e,t,n,o,i){let{from:a,to:r}=i,s={x:Math.min(a.x,r.x),y:Math.min(a.y,r.y)},l={x:Math.max(a.x,r.x),y:Math.max(a.y,r.y)};console.debug("getBoundsByRect, p1 p2",s,l,"vp zoom w h",e,t,n,o,{from:a,to:r});let{lon:d,lat:c}=_(s,e,t,n,o),{lon:u,lat:m}=_(l,e,t,n,o);return{left:d,bottom:m,right:u,top:c}}let S=e=>t=>0!==e.x&&0!==e.y?_(e,t.viewpoint,t.zoom,t.width,t.height):void 0;var k=n(7412);function M(e){return JSON.parse(JSON.stringify(e))}let E=e=>Object.keys(e);class C{debounce(e,t,n){let o=arguments.length>3&&void 0!==arguments[3]&&arguments[3];var i=this;return function(){for(var a=arguments.length,r=Array(a),s=0;s<a;s++)r[s]=arguments[s];let l=o&&!i.timers.has(n);i.timers.has(n)&&clearTimeout(i.timers.get(n));let d=setTimeout(()=>{i.timers.delete(n),o||e(...r)},t);i.timers.set(n,d),l&&e(...r)}}cancel(e){this.timers.has(e)&&(clearTimeout(this.timers.get(e)),this.timers.delete(e))}cancelAll(){for(let e of this.timers.values())clearTimeout(e);this.timers.clear()}constructor(){(0,k._)(this,"timers",new Map)}}function R(e){return e?Array.isArray(e)?e:[e]:[]}let T=function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return t.filter(Boolean).join(" ")};class O{appendNext(e,t){let n=e instanceof O?e:e.entry;if(t.isEpsilon)this.next.push({isEpsilon:!0,state:n});else{if(!t.transform)throw Error("Non-ε transition requires a transform function.");this.next.push({isEpsilon:!1,transform:t.transform,state:n})}}constructor(e){(0,k._)(this,"name",void 0),(0,k._)(this,"next",[]),this.name=e}}class P{appendNext(e,t){this.accept.forEach(n=>n.appendNext(e,t))}computeEpsilonClosure(e){let t=new Set,n=[e];for(;n.length;){let e=n.pop();if(!t.has(e))for(let{state:o,isEpsilon:i}of(t.add(e),e.next))i&&n.push(o)}return Array.from(t)}transform(e){for(let t of this.computeEpsilonClosure(this.current))for(let n of t.next)if(!n.isEpsilon&&n.transform(e)){this.current=n.state;return}}debouncedTransform(e){this.debouncer.debounce(this.transform.bind(this),P.DEBOUNCE_DELAY,e.type,!0)(e)}constructor(e){(0,k._)(this,"name",void 0),(0,k._)(this,"entry",void 0),(0,k._)(this,"current",void 0),(0,k._)(this,"accept",void 0),(0,k._)(this,"debouncer",void 0),(0,k._)(this,"context",void 0),this.name="base",this.context={store:e},this.debouncer=new C}}function D(e,t,n){let{stage:o}=n.store.view.getState(),i=o.view.getBoundingClientRect(),a=e-i.x,r=t-i.y;return console.debug("getLocalPosistion, x y",e,t," convert to ",a,r),{x:a,y:r}}(0,k._)(P,"DEBOUNCE_DELAY",20);let A=(e,t,n)=>{var o;let{height:i,width:a,viewpoint:r,zoom:s,stage:l}=n.store.view.getState();if(!i||!a||!l)return;let d=l.view.getBoundingClientRect(),c=e-d.x,u=t-d.y,{modifyFeatureMetaNC:m}=n.store.meta.getState(),p=_({x:c,y:u},r,s,a,i);if(console.log("on component drag",{x:e,y:t},{x:c,y:u},v(p,r,s,a,i)),(null===(o=n.componentTarget)||void 0===o?void 0:o.id)&&"node"===n.componentTarget.type){let{type:e,id:t}=n.componentTarget;m(e,t,e=>{e["@_lon"]=p.lon,e["@_lat"]=p.lat})}else throw Error(`context.componentTarget should not be ${JSON.stringify(n.componentTarget)} at point move`)};class I extends P{constructor(e){super(e),(0,k._)(this,"idle",void 0),(0,k._)(this,"componentHover",void 0),(0,k._)(this,"componentMousedown",void 0),(0,k._)(this,"pointDrag",void 0),this.idle=new O("component-idle"),this.componentHover=new O("component-hover"),this.componentMousedown=new O("component-mousedown"),this.pointDrag=new O("component-drag"),this.entry=this.idle,this.current=this.idle,this.accept=[this.idle],this.idle.appendNext(this.componentHover,{transform:e=>{let t=this.context;if(["pointerover","pointerenter"].includes(e.type)&&"componentTarget"in e&&e.componentTarget){t.componentTarget=e.componentTarget;let{id:n,type:o}=t.componentTarget;console.log("ComponentStateMachine: component hover triggered",o,n);let{modifyFeatureStateNC:i}=t.store.meta.getState();return i(o,n,e=>e.hovered=!0),!0}return!1}}),this.componentHover.appendNext(this.componentMousedown,{transform:e=>{let t=this.context;if("mousedown"===e.type&&t.componentTarget){console.log("ComponentStateMachine: transition to mousedown");let{id:e,type:n}=t.componentTarget,{modifyFeatureStateNC:o}=t.store.meta.getState();return o(n,e,e=>e.hovered=!1),!0}return!1}}),this.componentHover.appendNext(this.idle,{transform:e=>{let t=this.context;if(["pointerleave","pointerout"].includes(e.type)&&t.componentTarget){console.log("ComponentStateMachine: transition to idle");let{id:e,type:n}=t.componentTarget,{modifyFeatureStateNC:o}=t.store.meta.getState();return o(n,e,e=>e.hovered=!1),t.componentTarget=void 0,!0}return!1}}),this.componentMousedown.appendNext(this.pointDrag,{transform:e=>{var t;let n=this.context;if("pointermove"===e.type&&"node"===(null===(t=n.componentTarget)||void 0===t?void 0:t.type)){console.log("ComponentStateMachine: start dragging");let{clientX:t,clientY:o}=e,{commit:i}=n.store.meta.getState();return i(),A(t,o,n),!0}return!1}}),this.componentMousedown.appendNext(this.idle,{transform:e=>{let t=this.context;if(("mouseup"===e.type||"mouseupoutside"===e.type)&&t.componentTarget){let{selectFeature:n,unSelectFeature:o}=t.store.meta.getState(),{id:i,type:a}=t.componentTarget;if("string"==typeof i)e.ctrlKey?o(a,i):(n(a,i,!e.shiftKey),console.log("selected id",i,t.store.meta.getState().selectFeature)),t.componentTarget=void 0;else throw Error(`id ${i} is invalid for component`);return!0}return!1}}),this.pointDrag.appendNext(this.idle,{transform:e=>("mouseup"===e.type||"mouseuppoutside"===e.type)&&(console.log("ComponentStateMachine: drag canceled, back to idle"),this.context.componentTarget=void 0,!0)}),this.pointDrag.appendNext(this.pointDrag,{transform:e=>{if("pointermove"===e.type){let{clientX:t,clientY:n}=e;return A(t,n,this.context),!0}return!1}})}}var L=((i={})[i.LEFT=0]="LEFT",i[i.MIDDLE=1]="MIDDLE",i[i.RIGHT=2]="RIGHT",i[i.BACK=3]="BACK",i[i.FORWARD=4]="FORWARD",i);class F extends P{constructor(e,t){super(e),(0,k._)(this,"idle",void 0),(0,k._)(this,"rightMousedown",void 0),(0,k._)(this,"mapDrag",void 0),this.idle=new O("mapview-idle"),this.mapDrag=new O("mapview-mapDrag"),this.rightMousedown=new O("mapview-right-mousedown"),this.entry=this.idle,this.current=this.idle,this.accept=[this.idle],this.idle.appendNext(this.idle,{transform:e=>{let t=this.context;if("wheel"===e.type){let{zoom:n,setZoom:o}=t.store.view.getState(),i=t.store.settings.getState(),a=n*Math.pow(2,-(2e-4*e.deltaY)),r=Math.ceil(a)-a<.09?Math.ceil(a):a;return r>=0&&r<i.view.MAX_ZOOM+.99&&o(r),!0}return!1}}),this.idle.appendNext(this.mapDrag,{transform:e=>{let t=this.context;if(e.componentTarget)return!1;if("mousedown"===e.type&&!e.shiftKey&&e.button===L.LEFT){let{clientX:n,clientY:o}=e;return t.startPoint={x:n,y:o},t.viewpointBeforeDrag=t.store.view.getState().viewpoint,console.log("MapViewStateMachine: 开始地图拖拽",t.startPoint),!0}return!1}}),this.idle.appendNext(this.rightMousedown,{transform:e=>{if(e.componentTarget)return!1;if("mousedown"===e.type&&!e.shiftKey&&e.button===L.RIGHT){let{clientX:t,clientY:n}=e;return this.context.startPoint={x:t,y:n},this.context.viewpointBeforeDrag=this.context.store.view.getState().viewpoint,!0}return!1}}),this.rightMousedown.appendNext(this.idle,{transform:e=>"mouseup"===e.type&&(t&&t.rightClickHandeler(e),this.context.startPoint=void 0,this.context.viewpointBeforeDrag=void 0,!0)});let n=e=>{let t=this.context;if("pointermove"===e.type){var n,o;let{clientX:i,clientY:a}=e,[r,s]=[i,a];if("number"!=typeof(null===(n=t.startPoint)||void 0===n?void 0:n.x)||"number"!=typeof(null===(o=t.startPoint)||void 0===o?void 0:o.y))throw Error("context.startPoint.x must be number when map drag");let[l,d]=[t.startPoint.x-r,t.startPoint.y-s];console.log("moving to",l,d);let{zoom:c,setViewpoint:u,width:m,height:p}=t.store.view.getState();return u(_({x:l+m/2,y:d+p/2},t.viewpointBeforeDrag,c,m,p)),!0}return!1};this.rightMousedown.appendNext(this.mapDrag,{transform:n}),this.mapDrag.appendNext(this.mapDrag,{transform:n}),this.mapDrag.appendNext(this.idle,{transform:e=>{let t=this.context;if("mouseup"===e.type||"mouseupoutside"===e.type){if(t.startPoint=void 0,t.viewpointBeforeDrag=void 0,t.store.meta.getState().autoload){let{viewpoint:e,zoom:n,width:o,height:i}=t.store.view.getState(),{loadbbox:a}=t.store.meta.getState();a({width:o,height:i,zoom:n,viewpoint:e},t.store.settings.getState().osmAPI.BASEURL)}return!0}return!1}})}}var $=n(1525);function B(e,t){let n=null,o=null,i=1/0,a=$.al(e.lon,e.lat);for(let e=0;e<t.length-1;e++){let r=function(e,t,n){let o=$.Ue();$.$X(o,n,t);let i=$.x9(o);if(0===i)return $.d9(t);let a=$.Ue();$.$X(a,e,t);let r=Math.max(0,Math.min(1,$.AK(a,o)/i)),s=$.Ue();return $.od(s,t,o,r),s}(a,$.al(t[e]["@_lon"],t[e]["@_lat"]),$.al(t[e+1]["@_lon"],t[e+1]["@_lat"])),s=$.TE(a,r);s<i&&(i=s,n=$.d9(r),o=t[e])}if(null===o)throw Error("point is not insertable for polyline");return{nearestPoint:n?{lon:n[0],lat:n[1]}:e,insertAfter:o}}class U extends P{constructor(e){super(e),(0,k._)(this,"idle",void 0),this.idle=new O("undo-redo-idle"),this.entry=this.idle,this.current=this.idle,this.accept=[this.idle],this.idle.appendNext(this.idle,{transform:e=>{if("keydown"===e.type){let{undo:t,redo:n}=this.context.store.meta.temporal.getState();if("KeyZ"===e.code){if(e.shiftKey&&e.ctrlKey)return console.log("redo"),n(),!0;if(e.ctrlKey)return console.log("undo"),t(),!0}}if("utils-undo"===e.type){let{undo:e}=this.context.store.meta.temporal.getState();return console.log("undo"),e(),!0}if("utils-redo"===e.type){let{redo:e}=this.context.store.meta.temporal.getState();return console.log("redo"),e(),!0}return!1}})}}class G extends P{constructor(e){super(e),(0,k._)(this,"idle",void 0),(0,k._)(this,"undoRedo",void 0),(0,k._)(this,"addNode",void 0),(0,k._)(this,"addNodeOnWay",void 0),(0,k._)(this,"splitWay",void 0),this.idle=new O("node-idle"),this.addNode=new O("add-node"),this.addNodeOnWay=new O("add-node-on-way"),this.splitWay=new O("split-way"),this.undoRedo=new U(e),this.entry=this.idle,this.current=this.idle,this.accept=[this.idle],this.idle.appendNext(this.undoRedo,{isEpsilon:!0}),this.undoRedo.appendNext(this.idle,{isEpsilon:!0}),this.idle.appendNext(this.idle,{transform:e=>{if("keydown"===e.type){let{undo:t,redo:n}=this.context.store.meta.temporal.getState();if("KeyZ"===e.code){if(e.shiftKey&&e.ctrlKey)return console.log("redo"),n(),!0;if(e.ctrlKey)return console.log("undo"),t(),!0}}if("utils-undo"===e.type){let{undo:e}=this.context.store.meta.temporal.getState();return console.log("undo"),e(),!0}if("utils-redo"===e.type){let{redo:e}=this.context.store.meta.temporal.getState();return console.log("redo"),e(),!0}return!1}}),this.idle.appendNext(this.addNode,{transform:e=>"add-node"===e.type&&(console.log("to addnode way state"),!0)}),this.idle.appendNext(this.addNodeOnWay,{transform:e=>"add-node-on-way"===e.type&&(console.log("to addnode way state"),!0)}),this.idle.appendNext(this.splitWay,{transform:e=>"split-way"===e.type&&(console.log("to split way state"),!0)}),this.addNode.appendNext(this.idle,{transform:e=>{if("mousedown"===e.type){if(0===e.button){let{viewpoint:t,zoom:n,width:o,height:i}=this.context.store.view.getState(),{clientX:a,clientY:r}=e,s=_({x:a,y:r},t,n,o,i);this.context.store.meta.getState().createLocalNode(s),console.log("added node")}return!0}return!1}}),this.addNodeOnWay.appendNext(this.idle,{transform:e=>{if("mousedown"===e.type){if(0===e.button&&e.componentTarget&&"way"===e.componentTarget.type){let{viewpoint:t,zoom:n,width:o,height:i}=this.context.store.view.getState(),{meta:a,createLocalNode:r,modifyFeatureMetaNC:s,commit:l}=this.context.store.meta.getState(),{clientX:d,clientY:c}=e,u=_({x:d,y:c},t,n,o,i),m=a.way[e.componentTarget.id],{nearestPoint:p,insertAfter:h}=B(u,m.nd.map(e=>a.node[e["@_ref"]])),f=r(p),x=Array.from(m.nd);x.splice(m.nd.findIndex(e=>e["@_ref"]===h["@_id"])+1,0,{"@_ref":f}),l(),s(e.componentTarget.type,e.componentTarget.id,e=>e.nd=x),console.log("nodeid",f,x),console.log("added node")}return!0}return!1}}),this.splitWay.appendNext(this.idle,{transform:e=>{if("mousedown"===e.type){if(0===e.button&&e.componentTarget&&"node"===e.componentTarget.type){let{meta:t,splitWay:n}=this.context.store.meta.getState();n(t.node[e.componentTarget.id]["@_id"]),console.log("splited way")}return!0}return!1}})}}class W extends P{constructor(e){super(e),(0,k._)(this,"idle",void 0),(0,k._)(this,"componentSubMachine",void 0),(0,k._)(this,"mapViewSubMachine",void 0),(0,k._)(this,"uiStateSubMachine",void 0),this.idle=new O("common-edit-idle"),this.componentSubMachine=new I(e),this.mapViewSubMachine=new F(e),this.uiStateSubMachine=new G(e),this.entry=this.idle,this.current=this.idle,this.accept=[this.idle],this.idle.appendNext(this.componentSubMachine,{isEpsilon:!0}),this.idle.appendNext(this.mapViewSubMachine,{isEpsilon:!0}),this.idle.appendNext(this.uiStateSubMachine,{isEpsilon:!0}),this.componentSubMachine.appendNext(this.idle,{isEpsilon:!0}),this.mapViewSubMachine.appendNext(this.idle,{isEpsilon:!0}),this.uiStateSubMachine.appendNext(this.idle,{isEpsilon:!0})}}let q={commitCounter:1,selectedRef:[],activeRef:void 0,meta:{node:{},way:{},relation:{}},deletedMeta:{node:{},way:{},relation:{}},_create_feature_counter:-1,bbox:[],autoload:!0,routeEdit:{step:0,stops:[],path:[]}};function V(e){e.commitCounter++}let H=e=>({commit:()=>e(e=>V(e))});var z=n(4522),K=n(6622),X=n(4639);let Z=e=>{let{node:t,way:n,relation:o}=e,i={elems:{node:{},way:{},relation:{}},roots:{node:{},way:{},relation:{}}},a=(e,t)=>{Object.keys(t).forEach(t=>{i.elems[e][t]={id:t,type:e,fathers:{node:[],way:[],relation:[]},childs:{node:[],way:[],relation:[]}},i.roots[e][t]=!0})};return a("node",t),a("way",n),a("relation",o),Object.values(n).forEach(e=>{let t=i.elems.way[e["@_id"]];if(!t)throw Error(`${e["@_id"]} !`);e.nd.forEach(e=>{let n=i.elems.node[e["@_ref"]];n&&(n.fathers.way.push(t.id),t.childs.node.push(n.id),delete i.roots.node[n.id])})}),Object.values(o).forEach(e=>{let t=i.elems.relation[e["@_id"]];if(!t)throw Error(`${e["@_id"]} !`);e.member.forEach(e=>{let n=i.elems[e["@_type"]][e["@_ref"]];n&&(n.fathers.relation.push(t.id),t.childs[e["@_type"]].push(n.id),delete i.roots[e["@_type"]][n.id])})}),i},J=(0,X.createComputed)(e=>({tree:Z(e.meta)}));function Y(e,t,n,o){let i=e.meta[t][n]["@_localStates"];i&&o(i)}function Q(e,t,n){e.meta[t][n]["@_localStates"]={visible:!0,highlighted:!1,hovered:!1,selected:!1,active:!1}}function ee(e,t,n){if(e.activeRef){let{type:t,id:n}=e.activeRef;e.meta[t][n]["@_localStates"]&&(e.meta[t][n]["@_localStates"].active=!1)}e.activeRef={type:t,id:n},e.meta[t][n]["@_localStates"]&&(e.meta[t][n]["@_localStates"].active=!0)}function et(e,t,n){!e.selectedRef.some(e=>e.type===t&&e.id===n)&&(e.selectedRef.push({type:t,id:n}),e.meta[t][n]["@_localStates"]&&(e.meta[t][n]["@_localStates"].selected=!0))}function en(e){if(e.activeRef){let{type:t,id:n}=e.activeRef;e.meta[t][n]["@_localStates"]&&(e.meta[t][n]["@_localStates"].active=!1),e.activeRef=void 0}e.selectedRef.forEach(t=>{let{id:n,type:o}=t;return e.meta[o][n]["@_localStates"]&&(e.meta[o][n]["@_localStates"].selected=!1)}),e.selectedRef=[]}function eo(e,t,n){et(e,t,n),ee(e,t,n)}function ei(e,t,n){let o=e.meta[t][n]["@_localStates"];if((null==o?void 0:o.active)&&(o.active=!1,e.activeRef=void 0),(null==o?void 0:o.selected)&&(o.selected=!1,e.selectedRef=e.selectedRef.filter(e=>e.id!==n||e.type!==t)),!e.activeRef&&e.selectedRef.length>0){let{type:t,id:n}=e.selectedRef[0];ee(e,t,n)}}let ea=(e,t)=>({"@_id":`${e._create_feature_counter--}`,"@_lat":t.lat,"@_lon":t.lon,"@_visible":"true"}),er=(e,t)=>({"@_id":`${e._create_feature_counter--}`,nd:[...t],"@_visible":"true"}),es=(e,t)=>({"@_id":`${e._create_feature_counter--}`,member:[...t],"@_visible":"true"});function el(e,t,n){let o=n["@_id"];e.meta[t][o]&&console.debug(`Can't add feature ${t} ${o}: already exsits! Ignoring this attempt`),"node"===t&&(n["@_lon"]=Number(n["@_lon"]),n["@_lat"]=Number(n["@_lat"])),e.meta[t][o]=n,Q(e,t,o)}function ed(e,t){let n=ea(e,t);return e.meta.node[n["@_id"]]=n,Q(e,"node",n["@_id"]),n["@_id"]}function ec(e,t){let n=es(e,t);return e.meta.relation[n["@_id"]]=n,Q(e,"relation",n["@_id"]),n["@_id"]}let eu=(e,t,n,o)=>{let i=e.meta[t][n];i&&(o(i),i["@_action"]="modify")};function em(e,t,n){if(!e.meta[t][n])throw Error(`Can't delete feature ${t} ${n}: not exsit!`);e.deletedMeta[t][n]=e.meta[t][n],function(e,t,n){let o=e=>e.type===t&&e.id===n;e.selectedRef.some(o)&&(e.selectedRef=e.selectedRef.filter(e=>!o(e))),e.activeRef&&o(e.activeRef)&&(e.activeRef=void 0),delete e.meta[t][n]["@_localStates"]}(e,t,n),delete e.meta[t][n]}function ep(e,t,n){e.meta.way[n].nd.forEach(n=>{let o=n["@_ref"],{way:i,relation:a}=t.elems.node[o].fathers;!(i.length>1)&&!(a.length>0)&&em(e,"node",o)});let{relation:o}=t.elems.way[n].fathers;o.forEach(t=>{eu(e,"relation",t,e=>{e.member=e.member.filter(e=>"way"===e["@_type"]&&e["@_ref"]===n)})}),em(e,"way",n)}var eh=n(6932);let ef=["tag","nd","member","node","way","relation"];async function ex(e,t){let n=`${e}${t}`,o=await fetch(n);if(!o.ok)throw Error(`Error on fetching ${n}: ${o.statusText}`);let i=await o.text(),a=new eh.XMLParser({ignoreAttributes:!1,attributeNamePrefix:"@_",isArray:(e,t,n,o)=>!o&&ef.includes(e)}).parse(i);return console.log(`Get ${n}`,JSON.stringify(a),a),a}async function eb(e,t,n,o,i){let a=await ex(e,`/api/0.6/map?bbox=${t},${n},${o},${i}`);return a.osm.bounds["@_maxlat"]=Number(a.osm.bounds["@_maxlat"]),a.osm.bounds["@_minlat"]=Number(a.osm.bounds["@_minlat"]),a.osm.bounds["@_maxlon"]=Number(a.osm.bounds["@_maxlon"]),a.osm.bounds["@_minlon"]=Number(a.osm.bounds["@_minlon"]),a.osm.node=R(a.osm.node).map(e=>(e["@_lat"]=Number(e["@_lat"]),e["@_lon"]=Number(e["@_lon"]),e.tag&&(e.tag=R(e.tag)),e)),a}async function eg(e,t){let n=(await ex(e,`/api/0.6/node/${t}`)).osm.node;return n["@_lon"]=Number(n["@_lon"]),n["@_lat"]=Number(n["@_lat"]),n}async function ey(e,t){return(await ex(e,`/api/0.6/way/${t}`)).osm.way}async function ew(e,t){return(await ex(e,`/api/0.6/relation/${t}`)).osm.relation}async function ev(e,t){if(0===t.length)return[];let n=t.join(","),o=`/api/0.6/nodes?nodes=${n}`;return R((await ex(e,o)).osm.node).map(e=>(e["@_lat"]=Number(e["@_lat"]),e["@_lon"]=Number(e["@_lon"]),e))}async function e_(e,t){if(0===t.length)return[];let n=t.join(","),o=`/api/0.6/ways?ways=${n}`;return R((await ex(e,o)).osm.way)}async function ej(e,t){if(0===t.length)return[];let n=t.join(","),o=`/api/0.6/relations?relations=${n}`;return R((await ex(e,o)).osm.relation)}async function eN(e,t,n){let{viewpoint:o,zoom:i,width:a,height:r}=t,{left:s,bottom:l,right:d,top:c}=j(o,i,a,r);return e.some(e=>e.osm.bounds["@_minlon"]<=s+1e-7&&e.osm.bounds["@_minlat"]<=l+1e-7&&e.osm.bounds["@_maxlon"]>=d-1e-7&&e.osm.bounds["@_maxlat"]>=c-1e-7)?(console.log("requested bbox is already cached"),null):(console.log(`osm load data, faild to get cache: ${s} ${l} ${d} ${c}`,o,i),console.log("state bboxs",e),await eb(n,s,l,d,c))}function eS(e,t,n){let o=ed(e,t);return eu(e,"node",o,n),o}function ek(e,t,n,o){let i="0";return eu(e,"way",o,o=>{let{nearestPoint:a,insertAfter:r}=B(t,o.nd.map(t=>e.meta.node[t["@_ref"]]));i=eS(e,a,n),o.nd.splice(o.nd.findIndex(e=>e["@_ref"]===r["@_id"])+1,0,{"@_ref":i})}),i}let eM=e=>({modifyFeatureStateNC:(t,n,o)=>e(e=>{Y(e,t,n,o)}),modifyFeatureStateBatchNC:t=>e(e=>{t.forEach(t=>{let{type:n,id:o,modify:i}=t;Y(e,n,o,i)})}),selectFeature:(t,n,o)=>e(e=>{V(e),o&&en(e),eo(e,t,n)}),selectFeatureWithoutActive:(t,n,o)=>e(e=>{V(e),o&&en(e),et(e,t,n)}),unSelectFeature:(t,n)=>e(e=>{V(e),ei(e,t,n)}),toggleFeature:(t,n,o)=>e(e=>{var i;V(e),(null===(i=e.meta[t][n]["@_localStates"])||void 0===i?void 0:i.selected)?ei(e,t,n):(o&&en(e),eo(e,t,n))}),toggleFeatureWithoutActive:(t,n,o)=>e(e=>{var i;(V(e),null===(i=e.meta[t][n]["@_localStates"])||void 0===i?void 0:i.selected)?ei(e,t,n):(o&&en(e),et(e,t,n))}),clearSelect:()=>e(e=>{V(e),en(e)})}),eE=(e,t)=>({addFeatureMetaBatch:(t,n)=>e(e=>R(n).forEach(n=>el(e,t,n))),createLocalNode:t=>{let n="0";return e(e=>{V(e),n=ed(e,t)}),n},createLocalWay:t=>{let n="0";return e(e=>{V(e),n=function(e,t){let n=er(e,t);return e.meta.way[n["@_id"]]=n,Q(e,"way",n["@_id"]),n["@_id"]}(e,t)}),n},createLocalRelation:t=>{let n="0";return e(e=>{V(e),n=ec(e,t)}),n},modifyFeatureMetaNC:(t,n,o)=>e(e=>{eu(e,t,n,o)}),deleteFeature:(n,o)=>e(e=>{V(e),function(e,t,n,o){if("node"===n)!function(e,t,n){let{way:o,relation:i}=t.elems.node[n].fathers;o.forEach(o=>{eu(e,"way",o,e=>{e.nd=e.nd.filter(e=>e["@_ref"]!==n)}),e.meta.way[o].nd.length<=1&&ep(e,t,o)}),i.forEach(t=>{eu(e,"relation",t,e=>{e.member=e.member.filter(e=>"node"===e["@_type"]&&e["@_ref"]===n)})}),em(e,"node",n)}(e,t,o);else if("way"===n)ep(e,t,o);else if("relation"===n)!function(e,t,n){let{relation:o}=t.elems.relation[n].fathers;o.forEach(t=>{eu(e,"relation",t,e=>{e.member=e.member.filter(e=>"relation"===e["@_type"]&&e["@_ref"]===n)})}),em(e,"relation",n)}(e,t,o);else throw Error(`Type ${n} not allowed.`)}(e,t().tree,n,o)}),splitWay:n=>e(e=>{V(e);let o=function(e,t,n){let o=t.elems.node[n].fathers.way.map(t=>e.meta.way[t]),i=null;return null==o||o.forEach(o=>{let a=o.nd,r=a.findIndex(e=>e["@_ref"]===n);if(0!==r&&r!==a.length-1){if(-1===r)throw Error(`way ${o} must contain node ${n}, the feature tree is broken.`);let s=a.slice(r);o.nd=a.slice(0,r+1),o["@_action"]="modify";let l=er(e,s);i=l["@_id"],l.tag=o.tag&&[...o.tag],e.meta.way[l["@_id"]]=l,Q(e,"way",l["@_id"]);let d=t.elems.way[o["@_id"]].fathers.relation.map(t=>e.meta.relation[t]);null==d||d.forEach(e=>{let t=e.member,n=t.findIndex(e=>e["@_ref"]===o["@_id"]);if(-1===n)throw Error(`relation ${e} must contain way ${o}, the feature tree is broken.`);t.splice(n+1,0,{"@_ref":l["@_id"],"@_type":"way","@_role":t[n]["@_role"]}),e.member=t,e["@_action"]="modify"})}}),i}(e,t().tree,n);o&&eo(e,"way",o)}),restoreDeletedFeature:(t,n)=>e(e=>{let o=e.deletedMeta[t][n];o&&(e.meta[t][n]={...o},delete e.deletedMeta[t][n],Q(e,t,n))})});function eC(e,t){if(!t)return null;let n=R(t);for(let t=0;t<n.length;t++){let o=n[t];if(o["@_k"]===e)return o["@_v"]}return null}let eR=(e,t,n,o,i,a)=>{let r=(s,l)=>{if("relation"===l){let l=a[s];l&&(n[s]||(n[s]=!0),R(l.member).forEach(s=>{let l=s["@_ref"],d=s["@_type"];"node"===d?!e[l]&&o[l]&&(e[l]=!0):"way"===d?!t[l]&&i[l]&&r(l,"way"):"relation"===d&&!n[l]&&a[l]&&r(l,"relation")}))}else if("way"===l){let n=i[s];if(!n)return;t[s]||(t[s]=!0),R(n.nd).forEach(t=>{let n=t["@_ref"];!e[n]&&o[n]&&(e[n]=!0)})}else if("node"===l){if(!o[s])return;e[s]||(e[s]=!0)}};return r},eT=e=>{let{node:t,way:n,relation:o}=e,i=function(e,t,n){let o={},i={},a={},r=eR(o,i,a,e,t,n);return Object.values(n).forEach(e=>{let t=eC("type",e.tag),n=eC("route_master",e.tag),o=eC("public_transport:version",e.tag);"route_master"===t&&"bus"===n?r(e["@_id"],"relation"):"route"===t&&"2"===o&&r(e["@_id"],"relation")}),{node:o,way:i,relation:a}}(t,n,o),a=function(e,t,n){let o={},i={},a={},r=eR(o,i,a,e,t,n);return Object.values(n).forEach(e=>{eC("highway",e.tag)&&r(e["@_id"],"relation")}),Object.values(t).forEach(e=>{eC("highway",e.tag)&&r(e["@_id"],"way")}),Object.values(e).forEach(e=>{eC("highway",e.tag)&&r(e["@_id"],"node")}),{node:o,way:i,relation:a}}(t,n,o);return{ptv2:i,highway:a,created:function(e,t,n){let o={},i={},a={},r=eR(o,i,a,e,t,n);return Object.values(n).forEach(e=>{0>Number(e["@_id"])&&r(e["@_id"],"relation")}),Object.values(t).forEach(e=>{0>Number(e["@_id"])&&r(e["@_id"],"way")}),Object.values(e).forEach(e=>{0>Number(e["@_id"])&&r(e["@_id"],"node")}),{node:o,way:i,relation:a}}(t,n,o),global:function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return t.reduce((e,t)=>(Object.assign(e.node,t.node),Object.assign(e.way,t.way),Object.assign(e.relation,t.relation),e),{node:{},way:{},relation:{}})}(i,a)}};function eO(e,t){let n={};for(let[o,i]of Object.entries(e))t(i)&&(n[o]=i);return n}let eP=(e,t)=>({loadbbox:async(n,o)=>{let{bbox:i,meta:a}=t();if(!(n.zoom<=16))try{let t=await eN(i||[],n,o);if(null===t)return;let{node:r,way:s,relation:l}=M(a),d=[],c=[],u=[];t.osm.node.forEach(e=>{let t=e["@_id"];r[t]||(r[t]=e,d.push(e))}),t.osm.way.forEach(e=>{let t=e["@_id"];s[t]||(s[t]=e,c.push(e))}),t.osm.relation.forEach(e=>{let t=e["@_id"];l[t]||(l[t]=e,u.push(e))});let m=eT({node:r,way:s,relation:l}),p={nodesId:new Set(Object.keys(m.global.node)),waysId:new Set(Object.keys(m.global.way)),relationsId:new Set(Object.keys(m.global.relation))},h=d.filter(e=>p.nodesId.has(e["@_id"])),f=c.filter(e=>p.waysId.has(e["@_id"])),x=u.filter(e=>p.relationsId.has(e["@_id"]));e(e=>{V(e),h.forEach(t=>{e.meta.node[t["@_id"]]||el(e,"node",t)}),f.forEach(t=>{e.meta.way[t["@_id"]]||el(e,"way",t)}),x.forEach(t=>{e.meta.relation[t["@_id"]]||el(e,"relation",t)}),e.bbox.push({...t,osm:{...t.osm,node:[],way:[],relation:[]}})})}catch(e){console.log(e)}},loadFeature:async(e,n,o)=>{let{meta:i,addFeatureMetaBatch:a}=t();if("node"===e)i.node[n]||a("node",await eg(o,n));else if("way"===e){let e=await ey(o,n);a("node",(await ev(o,e.nd.map(e=>e["@_ref"]))).filter(e=>!i.node[e["@_id"]])),i.way[n]||a("way",e)}else"relation"!==e||i.relation[n]||a("relation",await ew(o,n))},loadFeatureBatch:async(e,n)=>{let{meta:o,addFeatureMetaBatch:i}=t(),a=e.filter(e=>"node"===e.type&&!o.node[e.id]).map(e=>e.id),r=e.filter(e=>"way"===e.type&&!o.way[e.id]).map(e=>e.id),s=e.filter(e=>"relation"===e.type&&!o.relation[e.id]).map(e=>e.id);if(r.length>0){let e=await e_(n,r),t=e.map(e=>e.nd.map(e=>e["@_ref"]).filter(e=>!o.node[e])).flat();i("node",await ev(n,t)),i("way",e)}a.length>0&&i("node",await ev(n,a)),s.length>0&&i("relation",await ej(n,s))},setAutoloadNC:t=>e(e=>{e.autoload="function"==typeof t?t():t})}),eD=e=>{var t,n;return"node"===e["@_type"]||(null===(t=e["@_role"])||void 0===t?void 0:t.startsWith("stop"))||(null===(n=e["@_role"])||void 0===n?void 0:n.startsWith("platform"))},eA=e=>({createBusStopSel:(t,n)=>e(e=>{V(e);let o=eS(e,t,e=>{e.tag=n});eo(e,"node",o)}),createStopPositionSel:(t,n,o)=>e(e=>{V(e);let i=ek(e,t,e=>{e.tag=n},o);eo(e,"node",i)}),createNodeOnWay:(t,n,o)=>{let i="0";return e(e=>{V(e),i=ek(e,t,e=>{e.tag=n},o)}),i},createStopAreaSel:(t,n)=>e(e=>{V(e);let o=ec(e,n||[]);eu(e,"relation",o,e=>{e.tag=t}),eo(e,"relation",o)}),createEditRoute:(t,n)=>e(e=>{V(e);let o=ec(e,n||[]);eu(e,"relation",o,e=>{e.tag=t}),eo(e,"relation",o);let i=n||[],a=i.map((e,t)=>eD(e)?t:-1),r=a.lastIndexOf(Math.max(...a));e.routeEdit.editing=o,e.routeEdit.step=0,e.routeEdit.stops=i.slice(0,r+1),e.routeEdit.path=i.slice(r+1,i.length)}),setEditRoute:t=>e(e=>{var n;V(e);let o=(null===(n=e.meta.relation)||void 0===n?void 0:n[t].member)||[],i=o.map((e,t)=>eD(e)?t:-1),a=i.lastIndexOf(Math.max(...i));e.routeEdit.editing=t,e.routeEdit.step=0,e.routeEdit.stops=o.slice(0,a+1),e.routeEdit.path=o.slice(a+1,o.length)}),cancelEditRoute:()=>e(e=>{V(e),e.routeEdit.editing=void 0,e.routeEdit.step=0,e.routeEdit.stops=[],e.routeEdit.path=[]}),setRouteStop:t=>e(e=>{V(e),e.routeEdit.stops=t}),setRoutePath:t=>e(e=>{V(e),e.routeEdit.path=t}),setEditStepNC:t=>e(e=>{e.routeEdit.step=t}),saveEditRoute:()=>e(e=>{let{editing:t,stops:n,path:o}=e.routeEdit;t&&(V(e),eu(e,"relation",t,e=>{e.tag=[...e.tag||[]],e.member=[...n,...o]}),e.routeEdit.editing=void 0,e.routeEdit.stops=[],e.routeEdit.path=[],e.routeEdit.selectedMaster=void 0)}),setSelectedMaster:t=>e(e=>{e.routeEdit.selectedMaster=t}),clearSelectedMaster:()=>e(e=>{e.routeEdit.selectedMaster=void 0})}),eI=e=>({reset:()=>{e({...q})}});var eL=n(869);let eF={},e$=(0,m.U)()((0,c.mW)((0,c.tJ)(J((0,K.O)((0,z.n)(function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return{...q,...H(...t),...eM(...t),...eE(...t),...eP(...t),...eA(...t),...eI(...t)}}),{partialize:e=>{let{tree:t,...n}=e;return n},equality:(e,t)=>e.commitCounter===t.commitCounter,limit:50})),{name:"OSMMapStateStore",storage:(e=>{let{dbName:t,storeName:n}=e,o=async()=>(eF[t]||(eF[t]=(0,eL.X3)(t,1,{upgrade(e){e.objectStoreNames.contains(n)||e.createObjectStore(n)},terminated:()=>{delete eF[t]}})),eF[t]);return{getItem:async e=>{try{let t=await o(),i=await t.get(n,e);return i?JSON.parse(i):null}catch(e){return console.error("IDB getItem failed:",e),null}},setItem:async(e,t)=>{try{let i=(await o()).transaction(n,"readwrite");await i.store.put(JSON.stringify(t),e),await i.done}catch(e){console.error("IDB setItem failed:",e)}},removeItem:async e=>{try{let t=(await o()).transaction(n,"readwrite");await t.store.delete(e),await t.done}catch(e){console.error("IDB removeItem failed:",e)}}}})({dbName:"osm-map-store-db",storeName:"osm-map-state"}),partialize:e=>{let{tree:t,...n}=e;return n}}),{name:"OSMMapState"})),eB=e=>({updateSettingsAction:t=>e(()=>t)}),eU={osmAPI:{BASEURL:"https://api.openstreetmap.org",TILE_SOURCE:"https://tile.openstreetmap.org/{z}/{x}/{y}.png"},view:{MAX_ZOOM:19},pixiRender:{zIndex:{LINE:10,POINT:20,MASK:30}},appearance:{theme:"system"}},eG={name:"settingStore",storage:(0,c.FL)(()=>localStorage)},eW=(0,m.U)()((0,c.mW)((0,c.tJ)(function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return{...eU,...eB(...t)}},eG),{name:"Settings"}));var eq=n(8810);let eV=function(e){let{source:t,x:n,y:o,scale:i=1,mapViewStatus:{zoom:a,width:r,height:l,viewpoint:d}}=e,c=Math.trunc(a),u=t.replace("{z}",String(c)).replace("{x}",String(n)).replace("{y}",String(o)),m=w({x:256*n*i,y:256*o*i},d,a,r,l);return(0,s.jsx)(eq.jy,{scale:i+.004,image:u,position:m})};function eH(e){let{width:t,height:n}=e,o=eW(e=>e.osmAPI.TILE_SOURCE),i=x(),{viewpoint:a,zoom:r}=i,l=Math.trunc(r),d=Math.pow(2,r-l);return(0,s.jsx)(eq.W2,{children:(()=>{let{x:r,y:c}=y(g(a),l),[u,m,p,h]=[r-(t>>1),c-(n>>1),r+(t>>1),c+(n>>1)].map(e=>Math.floor(e/256)),f=[];for(let t=u;t<=p;t++)for(let n=m;n<=h;n++)f.push((0,s.jsx)(eV,{source:o,x:t,y:n,scale:d,mapViewStatus:{...e,...i}},`${t}-${n}`));return f})()})}var ez=n(7130),eK=n(1839),eX=n(6124);function eZ(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return Math.abs(e[0]-t[0])<=n&&Math.abs(e[1]-t[1])<=n}function eJ(e,t){let n=t[0]-e[0],o=t[1]-e[1];return Math.sqrt(n*n+o*o)}function eY(e,t){let n,o=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=t,r=[];for(let c=0;c<e.length;c++){let u=e[c];if(n){let e=eJ(n,u)-a;if(e>=0){var s,l,d;let c=(s=n,Math.atan2(u[1]-s[1],u[0]-s[0])),m=t*Math.cos(c),p=t*Math.sin(c),h=0,f=0;o&&(h=7*Math.cos(c+Math.PI/2),f=7*Math.sin(c+Math.PI/2));let x=[n[0]+a*Math.cos(c)+h,n[1]+a*Math.sin(c)+f],b=[n,x];for(i&&e>=100*t&&(t=Math.floor(e/100)),e-=t;e>=0;e-=t)l=x,d=[m,p],x=[l[0]+d[0],l[1]+d[1]],b.push(x);b.push(u),r.push({coords:b.slice(1,-1),angle:c+(o?Math.PI/2:0)})}a=-e}n=u}return r}function eQ(e){return"butt"===e?eK.$oy.BUTT:"square"===e?eK.$oy.SQUARE:eK.$oy.ROUND}function e0(e){return"bevel"===e?eK.Sat.BEVEL:"miter"===e?eK.Sat.MITER:eK.Sat.ROUND}let e1=eK.xEZ.from("src/location-pin.svg"),e2=eK.xEZ.from("src/circle.svg"),e3=eK.xEZ.from("src/bus.svg"),e4=eK.xEZ.from("src/arrow-right-long.svg"),e5={proposed:!0,planned:!0,construction:!0,disused:!0,abandoned:!0,was:!0,dismantled:!0,razed:!0,demolished:!0,destroyed:!0,removed:!0,obliterated:!0,intermittent:!0},e7={aerialway:{chair_lift:!0,drag_lift:!0,"j-bar":!0,magic_carpet:!0,mixed_lift:!0,platter:!0,rope_tow:!0,"t-bar":!0,zip_line:!0},highway:{motorway:!0},junction:{circular:!0,roundabout:!0},man_made:{goods_conveyor:!0,"piste:halfpipe":!0},"piste:type":{downhill:!0,sled:!0,yes:!0},roller_coaster:{track:!0},"seamark:type":{"two-way_route":!0,recommended_traffic_lane:!0,separation_lane:!0,separation_roundabout:!0},waterway:{canal:!0,ditch:!0,drain:!0,fish_pass:!0,flowline:!0,pressurised:!0,river:!0,spillway:!0,stream:!0,tidal_channel:!0}},e9={natural:{cliff:!0,coastline:!0},barrier:{retaining_wall:!0,kerb:!0,guard_rail:!0,city_wall:!0},man_made:{embankment:!0},waterway:{weir:!0}},e8={surface:{paved:!0,asphalt:!0,concrete:!0,chipseal:!0,"concrete:lanes":!0,"concrete:plates":!0}},e6=new Set(["motorway","trunk","primary","secondary","tertiary","residential","motorway_link","trunk_link","primary_link","secondary_link","tertiary_link","unclassified","road","service","track","living_street","bus_guideway","busway"]),te=new Set(["abandoned","construction","demolished","destroyed","dismantled","disused","intermittent","obliterated","planned","proposed","razed","removed","was"]),tt=RegExp("^("+Array.from(te).join("|")+"):"),tn={DEFAULTS:{fill:{width:2,color:0xaaaaaa,alpha:.3},casing:{width:5,color:4473924,alpha:1,cap:"round",join:"round"},stroke:{width:3,color:0xcccccc,alpha:1,cap:"round",join:"round"}},LIFECYCLE:{casing:{alpha:0},stroke:{dash:[7,3],cap:"butt"}},red:{fill:{color:0xe06e5f,alpha:.3}},green:{fill:{color:9228383,alpha:.3}},blue:{fill:{color:7853278,alpha:.3}},yellow:{fill:{color:0xffff94,alpha:.25}},gold:{fill:{color:0xc4be19,alpha:.3}},orange:{fill:{color:0xd6881a,alpha:.3}},pink:{fill:{color:0xe3a4f5,alpha:.3}},teal:{fill:{color:0x99e1aa,alpha:.3}},lightgreen:{fill:{color:0xbee83f,alpha:.3}},tan:{fill:{color:0xf5dcba,alpha:.3}},darkgray:{fill:{color:9211020,alpha:.5}},lightgray:{fill:{color:0xaaaaaa,alpha:.3}},motorway:{casing:{width:10,color:7354159},stroke:{width:8,color:0xcf2081}},trunk:{casing:{width:10,color:7354159},stroke:{width:8,color:0xdd2f22}},primary:{casing:{width:10,color:7354159},stroke:{width:8,color:0xf99806}},secondary:{casing:{width:10,color:7354159},stroke:{width:8,color:0xf3f312}},tertiary:{casing:{width:10,color:7354159},stroke:{width:8,color:0xfff9b3}},unclassified:{casing:{width:10,color:4473924},stroke:{width:8,color:0xddccaa}},residential:{casing:{width:10,color:4473924},stroke:{width:8,color:0xffffff}},living_street:{casing:{width:7,color:0xffffff},stroke:{width:5,color:0xcccccc}},service:{casing:{width:7,color:4473924},stroke:{width:5,color:0xffffff}},special_service:{casing:{width:7,color:4473924},stroke:{width:5,color:0xddccaa}},track:{casing:{width:7,color:7630703},stroke:{width:5,color:0xc5b59f}},pedestrian:{casing:{width:7,color:0xffffff},stroke:{width:5,color:0x998888,dash:[8,8],cap:"butt"}},path:{casing:{width:5,color:0xddccaa},stroke:{width:3,color:0x998888,dash:[6,6],cap:"butt"}},footway:{casing:{width:5,color:0xffffff},stroke:{width:3,color:0x998888,dash:[6,6],cap:"butt"}},crossing_marked:{casing:{width:5,color:0xddccaa},stroke:{width:3,color:4998212,dash:[6,3],cap:"butt"}},crossing_unmarked:{casing:{width:5,color:0xddccaa},stroke:{width:3,color:7826026,dash:[6,4],cap:"butt"}},cycleway:{casing:{width:5,color:0xffffff},stroke:{width:3,color:5810669,dash:[6,6],cap:"butt"}},bridleway:{casing:{width:5,color:0xffffff},stroke:{width:3,color:0xe06d5f,dash:[6,6],cap:"butt"}},corridor:{casing:{width:5,color:0xffffff},stroke:{width:3,color:9228383,dash:[2,8],cap:"round"}},steps:{casing:{width:5,color:0xffffff},stroke:{width:3,color:8507996,dash:[3,3],cap:"butt"}},river:{fill:{color:7853278,alpha:.3},casing:{width:10,color:4473924},stroke:{width:8,color:7855581}},stream:{fill:{color:7853278,alpha:.3},casing:{width:7,color:4473924},stroke:{width:5,color:7855581}},ridge:{stroke:{width:2,color:9228383}},runway:{casing:{width:10,color:0,cap:"butt"},stroke:{width:8,color:0xffffff,dash:[24,48],cap:"butt"}},taxiway:{casing:{width:7,color:4473924},stroke:{width:5,color:0xffff00}},railway:{casing:{width:7,color:5592405,cap:"butt"},stroke:{width:2,color:0xeeeeee,dash:[12,12],cap:"butt"}},ferry:{casing:{alpha:0},stroke:{width:3,color:5810669,dash:[12,8],cap:"butt"}},boundary:{casing:{width:6,color:8566270,cap:"butt"},stroke:{width:2,color:0xffffff,dash:[20,5,5,5],cap:"butt"}},boundary_park:{casing:{width:6,color:8566270,cap:"butt"},stroke:{width:2,color:0xb0e298,dash:[20,5,5,5],cap:"butt"}},barrier:{casing:{alpha:0},stroke:{width:3,color:0xdddddd,dash:[10,5,2,5],cap:"round"}},barrier_wall:{casing:{alpha:0},stroke:{width:3,color:0xdddddd,dash:[10,5,2,5],cap:"round"}},barrier_hedge:{fill:{color:9228383,alpha:.3},casing:{alpha:0},stroke:{width:3,color:9228383,dash:[10,5,2,5],cap:"round"}},tree_row:{casing:{width:7,color:4473924},stroke:{width:5,color:9228383}},construction:{casing:{width:10,color:0xffffff},stroke:{width:8,color:0xfc6c14,dash:[10,10],cap:"butt"}},pipeline:{casing:{width:7,color:4473924},stroke:{width:5,color:0xdddddd,dash:[80,2],cap:"butt"}},roller_coaster:{casing:{width:7,color:4473924},stroke:{width:5,color:0xdddddd,dash:[10,1],cap:"butt"}}},to={aeroway:{runway:"runway",taxiway:"taxiway"},amenity:{childcare:"yellow",college:"yellow",fountain:"blue",kindergarten:"yellow",parking:"darkgray",research_institute:"yellow",school:"yellow",university:"yellow"},building:{"*":"red"},barrier:{city_wall:"barrier_wall",hedge:"barrier_hedge",retaining_wall:"barrier_wall",wall:"barrier_wall","*":"barrier"},boundary:{protected_area:"boundary_park",national_park:"boundary_park","*":"boundary"},crossing:{marked:"crossing_marked",traffic_signals:"crossing_marked",uncontrolled:"crossing_marked",zebra:"crossing_marked","*":"crossing_unmarked"},golf:{green:"lightgreen"},highway:{bridleway:"bridleway",bus_guideway:"railway",busway:"special_service",corridor:"corridor",construction:"construction",cycleway:"cycleway",footway:"footway",living_street:"living_street",living_street_link:"living_street",motorway:"motorway",motorway_link:"motorway",path:"path",pedestrian:"pedestrian",primary:"primary",primary_link:"primary",residential:"residential",residential_link:"residential",secondary:"secondary",secondary_link:"secondary",service:"service",service_link:"service",steps:"steps",tertiary:"tertiary",tertiary_link:"tertiary",track:"track",trunk:"trunk",trunk_link:"trunk",unclassified:"unclassified",unclassified_link:"unclassified"},landuse:{cemetery:"lightgreen",commercial:"orange",construction:"gold",farmland:"lightgreen",farmyard:"tan",flowerbed:"green",forest:"green",grass:"green",industrial:"pink",landfill:"orange",meadow:"lightgreen",military:"orange",orchard:"lightgreen",quarry:"darkgray",railway:"darkgray",recreation_ground:"green",residential:"gold",retail:"orange",village_green:"green",vineyard:"lightgreen"},leisure:{garden:"green",golf_course:"green",nature_reserve:"green",park:"green",pitch:"green",swimming_pool:"blue",track:"yellow"},man_made:{adit:"darkgray",breakwater:"barrier_wall",groyne:"barrier_wall",pipeline:"pipeline"},military:{"*":"orange"},natural:{bare_rock:"darkgray",bay:"blue",beach:"yellow",cave_entrance:"darkgray",cliff:"darkgray",glacier:"lightgray",ridge:"ridge",rock:"darkgray",sand:"yellow",scree:"darkgray",scrub:"yellow",shingle:"darkgray",stone:"darkgray",strait:"blue",tree_row:"tree_row",water:"blue",wetland:"teal","*":"green"},power:{plant:"pink"},railway:{platform:"footway","*":"railway"},roller_coaster:{track:"roller_coaster"},route:{ferry:"ferry"},sport:{baseball:"yellow",basketball:"darkgray",beachvolleyball:"yellow",skateboard:"darkgray",softball:"yellow"},type:{waterway:"river"},waterway:{river:"river",dam:"DEFAULTS",weir:"DEFAULTS","*":"stream"},service:{alley:"special_service",driveway:"special_service","drive-through":"special_service",parking_aisle:"special_service","*":"special_service"}},ti=function(e){var t;let{line:n,nodePath:o,mapViewStatus:{viewpoint:i,zoom:a,width:r,height:d},status:{visible:c,hovered:u,selected:m,highlighted:p},layerRef:h,...f}=e,x=a>=16&&c,b=o.map(e=>v({lon:e["@_lon"],lat:e["@_lat"]},i,a,r,d)),g=(0,l.useRef)(null),y=(0,l.useRef)(null),w=function(e){let t;let n=tn.DEFAULTS,o={};for(let t of e)o[t["@_k"]]=t["@_v"];let i=n,a=999;for(let[e,n]of Object.entries(o)){let r=to[e];if(!r||!n||"service"===e&&void 0===o.highway)continue;let s=r[n]??r["*"],l=Object.keys(r).length;if(te.has(n)&&(l=999),s&&l<=a){let n=tn[s];if(!n){console.error(`invalid styleID: ${s}`);continue}if(i=n,a=l,t=e,1===a)break}}let r=!1;for(let[e,n]of Object.entries(o)){if(te.has(e)&&"no"!==n){r=!0;break}if((!t||e===t)&&te.has(n)){r=!0;break}if(!t&&tt.test(e)&&"no"!==n){r=!0;break}}let s={};for(let e of["fill","casing","stroke"]){var l,d,c,u,m,p,h,f,x,b,g,y;s[e]={};let t=null===(l=i[e])||void 0===l?void 0:l.width;if(void 0!==t&&"number"==typeof t)s[e].width=t;else{let t=null===(h=n[e])||void 0===h?void 0:h.width;void 0!==t&&(s[e].width=t)}let o=null===(d=i[e])||void 0===d?void 0:d.color;if(void 0!==o&&"number"==typeof o)s[e].color=o;else{let t=null===(f=n[e])||void 0===f?void 0:f.color;void 0!==t&&(s[e].color=t)}let a=null===(c=i[e])||void 0===c?void 0:c.alpha;if(void 0!==a&&"number"==typeof a)s[e].alpha=a;else{let t=null===(x=n[e])||void 0===x?void 0:x.alpha;void 0!==t&&(s[e].alpha=t)}let r=null===(u=i[e])||void 0===u?void 0:u.cap;if(void 0!==r&&"string"==typeof r)s[e].cap=r;else{let t=null===(b=n[e])||void 0===b?void 0:b.cap;void 0!==t&&(s[e].cap=t)}let w=null===(m=i[e])||void 0===m?void 0:m.join;if(void 0!==w&&"string"==typeof w)s[e].join=w;else{let t=null===(g=n[e])||void 0===g?void 0:g.join;void 0!==t&&(s[e].join=t)}let v=null===(p=i[e])||void 0===p?void 0:p.dash;if(void 0!==v&&Array.isArray(v))s[e].dash=v;else{let t=null===(y=n[e])||void 0===y?void 0:y.dash;void 0!==t&&(s[e].dash=t)}}let w=o.bridge,v=o.cutting,_=o.embankment,j=o.highway,N=o.tracktype,S=o.tunnel,k=o.surface;if("track"===j&&"grade1"!==N&&(k=k||"dirt"),(w||_||v)&&(s.casing.width=(s.casing.width||0)+7,s.casing.color=0,s.casing.cap="butt",(_||v)&&(s.casing.dash=[2,4])),S&&(s.stroke.alpha=.5),k&&j&&e6.has(j)&&!e8.surface[k]&&(w||(s.casing.color=0xcccccc),s.casing.cap="butt",s.casing.dash=[4,4]),r){let e=tn.LIFECYCLE;for(let t of["fill","casing","stroke"])if(e[t])for(let[n,o]of Object.entries(e[t]))s[t][n]=o}return s}(R(n.tag)),_=(0,l.useMemo)(()=>{var e;let t=Math.max(3,(null==w?void 0:null===(e=w.casing)||void 0===e?void 0:e.width)||0);return function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=eZ([e[0],e[1]],[e[e.length-2],e[e.length-1]],1e-4),o=new eK.mgq(e);t.native=!1,o.closeStroke=!1;let i={closePointEps:1e-4,indices:[],points:[],uvs:[]};eK.yRe.buildLine({shape:o,lineStyle:t},i);let a=i.points,r=i.indices,s=new Map,l=[],d=[],c=[NaN,NaN],u=[NaN,NaN],m=0,p=0,h=[NaN,NaN],f=[NaN,NaN],x=[NaN,NaN],b=NaN,g=NaN,y=NaN;for(let e=0;e<r.length;e+=3){let t=r[e],n=r[e+1],o=r[e+2],i=[a[2*t],a[2*t+1]],w=[a[2*n],a[2*n+1]],v=[a[2*o],a[2*o+1]];if(0===e)s.set(t,!0),s.set(n,!1),s.set(o,!0),l.push(i),d.push(w),l.push(v),u=w,c=v,m=eJ(i,v);else{let e,a,r,_=s.get(t),j=s.get(n),N=s.get(o);void 0===_&&eZ(i,h,1e-4)&&(_=s.get(b),s.set(t,_)),void 0===j&&eZ(w,f,1e-4)&&(j=s.get(g),s.set(n,j)),void 0===N&&eZ(v,x,1e-4)&&(N=s.get(y),s.set(o,N)),void 0===_&&(e=t,a=i,r=!N),void 0===j&&(e=n,a=w,r=!_),void 0===N&&(e=o,a=v,r=!j),void 0!==e&&(s.set(e,r),!0===r?(l.push(a),m+=eJ(c,a),c=a):(d.push(a),p+=eJ(u,a),u=a))}h=i,f=w,x=v,b=t,g=n,y=o}let w={},v=Array(2*(l.length+d.length+1)),_=0;for(let e=0;e<l.length;++_,++e)v[2*_]=l[e][0],v[2*_+1]=l[e][1];for(let e=d.length-1;e>=0;++_,--e)v[2*_]=d[e][0],v[2*_+1]=d[e][1];if(v[2*_]=l[0][0],v[2*_+1]=l[0][1],w.perimeter=v,n){let e=p>m?d:l,t=Array((e.length+1)*2);for(let n=0;n<e.length;++n)t[2*n]=e[n][0],t[2*n+1]=e[n][1];t[2*e.length]=e[0][0],t[2*e.length+1]=e[0][1],w.outer=t}return w}(b.flatMap(e=>[e.x,e.y]),{alignment:.5,color:0,width:t+10,alpha:1,join:eK.Sat.BEVEL,cap:eK.$oy.BUTT})},[b,w]),j=(0,l.useCallback)(e=>{e.clear();let t=w.casing||{};t.dash?e=new ez.d(e,{dash:t.dash,color:t.color,width:t.width,alpha:t.alpha||1,join:e0(t.join),cap:eQ(t.cap)}):e.lineStyle({color:t.color,width:t.width,alpha:t.alpha||1,join:e0(t.join),cap:eQ(t.cap)});let[n,...o]=b;e.moveTo(n.x,n.y),o.forEach(t=>{e.lineTo(t.x,t.y)})},[b,w.casing]),N=(0,l.useCallback)(e=>{e.clear();let t=w.stroke||{};t.dash?e=new ez.d(e,{dash:t.dash,color:t.color,width:t.width,alpha:t.alpha||1,join:e0(t.join),cap:eQ(t.cap)}):e.lineStyle({color:t.color,width:t.width,alpha:t.alpha||1,join:e0(t.join),cap:eQ(t.cap)});let[n,...o]=b;e.moveTo(n.x,n.y),o.forEach(t=>{e.lineTo(t.x,t.y)})},[b,w]),S=(0,l.useCallback)(()=>{g.current&&_.perimeter&&(g.current.hitArea=new eK.mgq(_.perimeter))},[g,_]);(0,l.useEffect)(()=>{let e=g.current;null!==e&&(S(),(()=>{let t=x&&u,n=x&&m,o=x&&p;if(t){if(!e.filters){let t=new eX.Vw({distance:15,outerStrength:3,color:0xffff00});t.resolution=2,e.filters=[t]}}else if(o){if(!e.filters){let t=new eX.Vw({distance:15,outerStrength:3,color:7377663});t.resolution=2,e.filters=[t]}}else e.filters&&(e.filters=null);if(n&&h.current){y.current||(y.current=new eK.TCu,h.current.addChild(y.current)),y.current.clear();let e=new ez.d(y.current,{alpha:.9,dash:[6,3],width:2,color:0xff0000});_&&(_.outer&&_.inner?(e.drawPolygon(_.outer),e.drawPolygon(_.inner)):e.drawPolygon(_.perimeter))}else y.current&&(y.current.destroy({children:!0}),y.current=null)})())},[p,u,m,x,S,_,h]),(0,l.useEffect)(()=>()=>{y.current&&!y.current.destroyed&&(y.current.destroy({children:!0}),y.current=null)},[]);let k=function(e){let t={yes:!0,1:!0,"-1":!0,reversible:!0,alternating:!0,no:!1,0:!1},n=null;return(e.forEach(e=>{"oneway"===e["@_k"]&&t[e["@_v"]]&&(n=t[e["@_v"]])}),null!==n)?n:(e.forEach(e=>{e["@_k"]in e7&&e["@_v"]in e7[e["@_k"]]&&(n=!0)}),!!n)}(R(n.tag)),M=!(t=R(n.tag)).some(e=>"two_sided"===e["@_k"]&&"yes"===e["@_v"])&&null!==(()=>{for(let e=0;e<t.length;e++){let n=t[e]["@_k"],o=t[e]["@_v"],i=function(e){let t=e.split(":");return 1===t.length?e:t[0]in e5?e.slice(t[0].length+1):e}(n);if(i in e9&&o in e9[i]){if(e9[i][o])return i;return e9[i][o]}}return null})();return(0,s.jsxs)(eq.W2,{visible:x,position:{x:0,y:0},ref:g,...f,children:[(0,s.jsx)(eq.TC,{draw:j}),(0,s.jsx)(eq.TC,{draw:N}),k&&eY(b.map(e=>[e.x,e.y]),35,!1,!0).map((e,t)=>e.coords.map((n,o)=>{let[i,a]=n;return(0,s.jsx)(eq.jy,{eventMode:"none",width:8,height:8,texture:e4,sortableChildren:!1,anchor:{x:.5,y:.5},position:{x:i,y:a},rotation:e.angle,tint:0},`${t}-${o}`)})).flat(),M&&eY(b.map(e=>[e.x,e.y]),35,!0,!0).map((e,t)=>e.coords.map((n,o)=>{let[i,a]=n;return(0,s.jsx)(eq.jy,{eventMode:"none",width:8,height:8,texture:e4,sortableChildren:!1,anchor:{x:.5,y:.5},position:{x:i,y:a},rotation:e.angle,tint:0},`${t}-${o}`)})).flat()]})};var ta=((a={}).BUS_STOP="bus stop",a.STOP_POSITION="stop posistion",a),tr=((r={}).ROUTE="route",r.ROUTE_MASTER="route master",r.STOP_AREA="stop area",r);function ts(e){return(e=e||[]).some(e=>"public_transport"===e["@_k"]&&"platform"===e["@_v"])&&e.some(e=>"highway"===e["@_k"]&&"bus_stop"===e["@_v"])}function tl(e){return(e=e||[]).some(e=>"public_transport"===e["@_k"]&&"stop_position"===e["@_v"])}function td(e){var t;return null===(t=(e=e||[]).find(e=>"name"===e["@_k"]))||void 0===t?void 0:t["@_v"]}function tc(e){return e?ts(e)?ta.BUS_STOP:tl(e)?ta.STOP_POSITION:void 0:void 0}({...ta,...tr});let tu=function(e){let{node:t,mapViewStatus:{width:n,height:o,viewpoint:i,zoom:a},status:{visible:r,hovered:d,selected:c,highlighted:u},layerRef:m,...p}=e,h=a>=16&&r,f=(0,l.useRef)(null),x=(0,l.useRef)(null),b=ts(R(t.tag)),g=v({lon:t["@_lon"],lat:t["@_lat"]},i,a,n,o),y=(0,l.useMemo)(()=>td(t.tag),[t.tag]),w=(0,l.useMemo)(()=>b?16:8,[b]);return((0,l.useEffect)(()=>{let e=f.current;e&&((()=>{if(!h)return;let t=new eK.Cdc(0,0,Math.max(10,w/2+5));e.hitArea=t})(),(()=>{let t=h&&d,n=h&&u,o=h&&c;if(t){if(!e.filters){let t=new eX.Vw({distance:15,outerStrength:3,color:0xffff00});t.resolution=2,e.filters=[t]}}else if(n){if(!e.filters){let t=new eX.Vw({distance:15,outerStrength:3,color:7377663});t.resolution=2,e.filters=[t]}}else e.filters&&(e.filters=null);if(o&&m.current){console.log("show select"),x.current||(x.current=new eK.TCu,m.current.addChild(x.current));let t={alpha:.9,dash:[6,3],width:3,color:0xff0000};x.current.clear();let n=e.hitArea;n instanceof eK.Cdc?(new ez.d(x.current,t).drawCircle(n.x+g.x,n.y+g.y,n.radius,20),console.log(x.current)):n instanceof eK.AeJ&&new ez.d(x.current,t).drawRect(n.x+g.x,n.y+g.y,n.width,n.height)}else x.current&&(x.current.destroy({children:!0}),x.current=null)})())},[a,u,d,h,"dot",c,m,g]),(0,l.useEffect)(()=>()=>{x.current&&!x.current.destroyed&&(x.current.destroy({children:!0}),x.current=null)},[]),(0,l.useEffect)(()=>{let e=f.current;e&&(a<16||(a<17?e.scale.set(.8,.8):e.scale.set(1,1)))},[a]),a<16)?null:(0,s.jsxs)(eq.W2,{...p,position:g,visible:h,ref:f,children:[(0,s.jsx)(eq.jy,{eventMode:"none",sortableChildren:!1,visible:!0,texture:e2,anchor:{x:.5,y:.5},width:w,height:w}),b&&(0,s.jsx)(eq.jy,{eventMode:"none",texture:e3,anchor:{x:.5,y:.5},width:11,height:11}),y&&a>16&&(0,s.jsx)(eq.xv,{text:y,anchor:.5,x:0,y:b?24:16,style:new eK.pn8({align:"center",fontFamily:'"Source Sans Pro", Helvetica, sans-serif',fontSize:12,fontWeight:"400",fill:"#ffffff",stroke:"#000000",strokeThickness:2,dropShadow:!0,dropShadowColor:"#ccced2",dropShadowBlur:3,dropShadowAngle:Math.PI/6,dropShadowDistance:2,wordWrap:!0,wordWrapWidth:440})})]})},tm=(0,l.forwardRef)(function(e,t){let{view:{width:n,height:o,viewpoint:i,zoom:a},meta:{node:r,way:d},pointRenderer:c,wayRenderer:u,...m}=e,{left:p,bottom:h,right:f,top:x}=(0,l.useMemo)(()=>j(i,a,n,o),[i,a,n,o]),b=(0,l.useCallback)(e=>{let{"@_lon":t,"@_lat":n}=e;return p<=t&&t<=f&&h<=n&&n<=x},[p,h,f,x]);return a<16?null:(0,s.jsxs)(eq.W2,{ref:t,...m,children:[Object.values(d).filter(e=>e.nd.map(e=>r[e["@_ref"]]).some(b)).map(u),Object.values(r).filter(b).map(c)]})});function tp(e){let{selectionRect:t}=e;if(!t)return null;let{from:n,to:o}=t,i=Math.min(n.x,o.x),a=Math.min(n.y,o.y),r=Math.abs(o.x-n.x),l=Math.abs(o.y-n.y);return(0,s.jsx)(eq.TC,{draw:e=>{e.clear(),e.beginFill(0xffa500,.5),e.drawRect(i,a,r,l),e.endFill()}})}function th(e){let{drawMode:t,viewpoint:n,zoom:o,width:i,height:a}=e;if(!t.fromPos||!t.curPos||!i||!a)return null;let r=v(t.fromPos,n,o,i,a),l=v(t.curPos,n,o,i,a);return(0,s.jsx)(eq.TC,{draw:e=>{e.clear(),e.lineStyle(2,2201331,.8),e.moveTo(r.x,r.y),e.lineTo(l.x,l.y)}})}function tf(e){let{node:t,stateMachine:n,...o}=e,i=t["@_localStates"],a=t["@_id"];return(0,s.jsx)(tu,{...o,node:t,status:i,eventMode:"static",mousedown:e=>n.transform({...e,componentTarget:{id:a,type:"node"}}),mouseup:e=>n.transform({...e,componentTarget:{id:a,type:"node"}}),pointerover:e=>n.transform({...e,componentTarget:{id:a,type:"node"}}),pointerout:e=>n.transform({...e,componentTarget:{id:a,type:"node"}})})}function tx(e){let{way:t,node:n,stateMachine:o,...i}=e,a=t["@_localStates"],r=t["@_id"],d=(0,l.useMemo)(()=>t.nd.map(e=>n[e["@_ref"]]),[n,t.nd]);return(0,s.jsx)(ti,{...i,line:t,nodePath:d,status:a,eventMode:"static",pointerover:e=>o.transform({...e,componentTarget:{id:r,type:"way"}}),pointerout:e=>o.transform({...e,componentTarget:{id:r,type:"way"}}),mousedown:e=>o.transform({...e,componentTarget:{id:r,type:"way"}}),mouseup:e=>o.transform({...e,componentTarget:{id:r,type:"way"}})})}let tb=function(e){let{width:t,height:n,stateMachine:o}=e,i=x(),{viewpoint:a,zoom:r,selectionRect:d}=i,{node:c,way:u}=e$(e=>e.meta),m=(0,l.useRef)(null);return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(tm,{view:{viewpoint:a,zoom:r,width:t,height:n},meta:{node:c,way:u},ref:m,wayRenderer:e=>(0,s.jsx)(tx,{way:e,node:c,stateMachine:o,mapViewStatus:{width:t,height:n,viewpoint:a,zoom:r},layerRef:m},e["@_id"]),pointRenderer:e=>(0,s.jsx)(tf,{node:e,stateMachine:o,mapViewStatus:{width:t,height:n,viewpoint:a,zoom:r},layerRef:m},e["@_id"])}),(0,s.jsx)(tp,{selectionRect:d}),(0,s.jsx)(th,{...i})]})};var tg=n(3475);function ty(e,t,n){e=M(e),t=M(t);let o={"?xml":{"@_version":"1.0","@_encoding":"UTF-8"},osm:{bounds:{"@_minlat":n.reduce((e,t)=>Math.min(e,t.osm.bounds["@_minlat"]),1/0),"@_minlon":n.reduce((e,t)=>Math.min(e,t.osm.bounds["@_minlon"]),1/0),"@_maxlat":n.reduce((e,t)=>Math.max(e,t.osm.bounds["@_maxlat"]),-1/0),"@_maxlon":n.reduce((e,t)=>Math.max(e,t.osm.bounds["@_maxlon"]),-1/0),"@_origin":"v0.0.2-BusFensi"},node:[...Object.values(e.node).map(e=>(delete e["@_localStates"],e)),...Object.values(t.node).map(e=>(e["@_action"]="delete",delete e["@_localStates"],e))],way:[...Object.values(e.way).map(e=>(delete e["@_localStates"],e)),...Object.values(t.way).map(e=>(e["@_action"]="delete",delete e["@_localStates"],e))],relation:[...Object.values(e.relation).map(e=>(delete e["@_localStates"],e)),...Object.values(t.relation).map(e=>(e["@_action"]="delete",delete e["@_localStates"],e))],"@_version":.6,"@_generator":"BusFensi"}};console.log(o,e);let i=new eh.XMLBuilder({ignoreAttributes:["localStates"],attributeNamePrefix:"@_",suppressBooleanAttributes:!1}).build(o);return console.log(i),i}function tw(e){let{stateMachine:t}=e,{createLocalWay:n,createLocalRelation:o,deleteFeature:i,selectFeature:a,clearSelect:r,selectedRef:d,meta:c,bbox:u,deletedMeta:m}=e$((0,tg.N)(e=>e)),{updateSettingsAction:p,...h}=eW(),[f,x]=(0,l.useState)(!1),[b,g]=(0,l.useState)(h);return(0,s.jsxs)("div",{className:"join",children:[(0,s.jsx)("button",{className:"btn btn-sm join-item",onMouseDown:()=>t.transform({type:"add-node"}),children:"Create Node"}),(0,s.jsx)("button",{className:"btn btn-sm join-item",onMouseDown:()=>t.transform({type:"add-node-on-way"}),children:"Create node on way"}),(0,s.jsx)("button",{className:"btn btn-sm join-item",onMouseDown:()=>t.transform({type:"split-way"}),children:"Split way"}),(0,s.jsx)("button",{className:"btn btn-sm join-item",onMouseDown:()=>{a("way",n(d.filter(e=>"node"===e.type).map(e=>({"@_ref":e.id}))),!1)},children:"Create way with select"}),(0,s.jsx)("button",{className:"btn btn-sm join-item",onMouseDown:()=>{a("relation",o(d.map(e=>({"@_ref":e.id,"@_type":e.type}))),!1)},children:"Create relation with select"}),(0,s.jsx)("button",{className:"btn btn-sm join-item",onMouseDown:()=>{let e=M(d);r(),e.forEach(e=>{if("node"===e.type||"way"===e.type||"relation"===e.type)i(e.type,e.id);else throw Error(`Type not found ${e.type} for id ${e.id}`)})},children:"Delete selected"}),(0,s.jsx)("button",{className:"btn btn-sm join-item",onMouseDown:()=>{let e=new Blob([ty(c,m,u)],{type:"application/xml"}),t=document.createElement("a");t.href=URL.createObjectURL(e),t.download="exported_data.osm",t.click(),URL.revokeObjectURL(t.href)},children:"export josm"}),(0,s.jsx)("button",{className:"btn btn-sm join-item",onMouseDown:()=>x(!0),children:"Change Settings"}),f&&(0,s.jsx)("div",{className:"modal modal-open",children:(0,s.jsxs)("div",{className:"modal-box",children:[(0,s.jsx)("h3",{className:"font-bold text-lg",children:"Change Settings"}),(0,s.jsxs)("div",{className:"py-4",children:[(0,s.jsx)("label",{className:"label",children:(0,s.jsx)("span",{className:"label-text",children:"OSM API Base URL"})}),(0,s.jsx)("input",{type:"text",value:b.osmAPI.BASEURL,onChange:e=>g({...b,osmAPI:{...b.osmAPI,BASEURL:e.target.value}}),className:"input input-bordered w-full"})]}),(0,s.jsxs)("div",{className:"py-4",children:[(0,s.jsx)("label",{className:"label",children:(0,s.jsx)("span",{className:"label-text",children:"OSM API Tile Source"})}),(0,s.jsx)("input",{type:"text",value:b.osmAPI.TILE_SOURCE,onChange:e=>g({...b,osmAPI:{...b.osmAPI,TILE_SOURCE:e.target.value}}),className:"input input-bordered w-full"})]}),(0,s.jsxs)("div",{className:"py-4",children:[(0,s.jsx)("label",{className:"label",children:(0,s.jsx)("span",{className:"label-text",children:"Max Zoom Level"})}),(0,s.jsx)("input",{type:"number",value:b.view.MAX_ZOOM,onChange:e=>g({...b,view:{...b.view,MAX_ZOOM:parseFloat(e.target.value)}}),className:"input input-bordered w-full"})]}),(0,s.jsxs)("div",{className:"modal-action",children:[(0,s.jsx)("button",{className:"btn",onClick:()=>{p(b),x(!1)},children:"Save"}),(0,s.jsx)("button",{className:"btn btn-ghost",onClick:()=>x(!1),children:"Cancel"})]})]})})]})}var tv=n(5706);let t_=e=>{let{id:t="drag-bar",dir:n,isDragging:o,...i}=e,[a,r]=(0,l.useState)(!1);return(0,s.jsx)("div",{id:t,"data-testid":t,tabIndex:0,className:T("flex-shrink-0 bg-base-300 transition-colors","horizontal"===n?"cursor-row-resize h-1":"cursor-col-resize w-1",(o||a)&&"bg-accent"),onFocus:()=>r(!0),onBlur:()=>r(!1),...i})},tj=e=>{let{width:t,height:n,children:o,...i}=e,{axis:a}=i,r=i.initial||("x"===a?t/2:n/2),{position:d,separatorProps:c,setPosition:u}=(0,tv.L)({...i,initial:r}),m=(0,l.useRef)("x"===a?t:n),p={},h={};return"x"===a?(p={width:d,height:n},h={width:t-d,height:n}):(p={width:t,height:d},h={width:t,height:n-d}),(0,l.useEffect)(()=>{"x"===a&&t!==m.current?(u(d*(t/m.current)),m.current=t):"y"===a&&n!==m.current&&(u(d*(n/m.current)),m.current=n)},[t,n,m,a,u,d]),(0,s.jsxs)("div",{style:{width:t,height:n,display:"flex",flexDirection:"x"===a?"row":"column",position:"relative"},children:[(0,s.jsx)("div",{style:p,children:o[0]({width:p.width,height:p.height})}),(0,s.jsx)(t_,{...c,dir:"x"===a?"vertical":"horizontal",isDragging:!1}),(0,s.jsx)("div",{style:h,children:o[1]({width:h.width,height:h.height})})]})};function tN(e){let{children:t}=e;return(0,s.jsx)("ul",{className:"menu menu-xs",children:t})}var tS=n(2163),tk=n(7596);function tM(e){let t,{featuretype:n,metatype:o,fullname:i,id:a,created:r,deleted:l,modified:d,children:c}=e;switch(n){case"node":t=tk.W3K;break;case"way":t=tk.KJ_;break;case"relation":t=tk.Hw7;break;default:t=tk.Psp}return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("span",{children:(0,s.jsx)(tS.G,{icon:t})}),(0,s.jsx)("span",{className:"font-semibold",children:i||"[untitled]"}),o&&(0,s.jsx)("span",{className:"badge badge-xs h-fit badge-outline text-nowrap",children:o}),(0,s.jsx)("div",{className:"badge badge-xs h-fit badge-outline",children:a}),(0,s.jsxs)("div",{className:"flex space-x-1",children:[r&&(0,s.jsx)("div",{className:"badge badge-xs badge-success tooltip tooltip-bottom","data-tip":"Created",children:(0,s.jsx)(tS.G,{icon:tk.r8p})}),d&&(0,s.jsx)("div",{className:"badge badge-xs badge-warning tooltip tooltip-bottom","data-tip":"Modified",children:(0,s.jsx)(tS.G,{icon:tk.Xcf})}),l&&(0,s.jsx)("div",{className:"badge badge-xs badge-error tooltip tooltip-bottom","data-tip":"Deleted",children:(0,s.jsx)(tS.G,{icon:tk.$aW})})]}),(0,s.jsx)("span",{className:"flex items-center ml-auto",children:c})]})}function tE(e){return(0,s.jsxs)("li",{children:[" ",(0,s.jsx)("span",{className:"flex select-text justify-between items-center rounded",children:(0,s.jsx)(tM,{...e})})]})}var tC=n(9467),tR=n(9814),tT=n(2619),tO=n(1908);function tP(e){let{show:t,proceed:n,title:o,message:i}=e,a=(0,l.useRef)(null);(0,l.useEffect)(()=>{let e=a.current;e&&(t?e.showModal():e.close())},[t]);let r=()=>{n(!1)};return(0,s.jsxs)("dialog",{ref:a,className:"modal",onClose:r,children:[(0,s.jsxs)("div",{className:"modal-box",children:[o&&(0,s.jsx)("h3",{className:"font-bold text-lg mb-2",children:o}),(0,s.jsx)("p",{children:i}),(0,s.jsxs)("div",{className:"modal-action",children:[(0,s.jsx)("button",{type:"button",className:"btn btn-md",onClick:r,children:"Cancel"}),(0,s.jsx)("button",{type:"button",className:"btn btn-primary",onClick:()=>{console.debug("clicking delete ok: "),n(!0)},children:"OK"})]})]}),(0,s.jsx)("form",{method:"dialog",className:"modal-backdrop",children:(0,s.jsx)("button",{children:"close"})})]})}let tD=(0,tO.confirmable)(e=>(0,s.jsx)(tP,{...e}));tD.displayName="ConfirmableSimpleConfirmation";var tA=n(5509);function tI(e){return"stop_area"===eC("public_transport",e=e||[])&&"public_transport"===eC("type",e)}function tL(e){return"route"===eC("type",e=e||[])}function tF(e){return"route_master"===eC("type",e=e||[])}function t$(e){if(e){if(!tI(e)){if(tL(e))return tr.ROUTE;if(tF(e))return tr.ROUTE_MASTER}}}var tB=n(3805);function tU(e){var t,n,o;let{type:i,meta:a,showMetaType:r,isDeleted:d,children:c}=e,u=a["@_id"],[m,p,h,f]=e$((0,tg.N)(e=>[e.selectFeature,e.unSelectFeature,e.deleteFeature,e.restoreDeletedFeature])),b=x(e=>e.setViewpoint),g=(0,tO.createConfirmation)(tD),y=(0,l.useMemo)(()=>{var e;if(r&&(null===(e=a.tag)||void 0===e?void 0:e.length)){if("node"===i)return tc(a.tag);if("relation"===i)return t$(a.tag)}},[r,a.tag,i]),w=(0,l.useCallback)(e=>{e.stopPropagation(),"node"===i&&b({lat:a["@_lat"],lon:a["@_lon"]})},[a,b,i]),v=(0,l.useCallback)(e=>{var t;e.stopPropagation(),(null===(t=a["@_localStates"])||void 0===t?void 0:t.selected)?p(i,u):m(i,u,!1)},[u,a,m,i,p]),_=(0,l.useCallback)(async e=>{e.stopPropagation(),console.debug("deleting: ",i,u);let t=await g({title:"Confirm delete feature",message:"Are you sure you want delete this feature?\n"+(td(a.tag||[])||u)});console.debug("confirmed deleting: ",t,i,u),t&&h(i,u)},[g,h,u,a.tag,i]);return(0,s.jsxs)(tE,{featuretype:i,id:u,metatype:y,fullname:td(a.tag),created:0>Number(a["@_id"]),deleted:d,modified:"modify"===a["@_action"],children:[!d&&(0,s.jsxs)(s.Fragment,{children:["node"===i&&(0,s.jsx)("button",{className:"btn btn-xs btn-square tooltip tooltip-bottom","data-tip":"Switch to position",onClick:w,children:(0,s.jsx)(tS.G,{icon:tC.faLocationDot})}),(0,s.jsx)("button",{className:T("btn btn-xs btn-square tooltip tooltip-bottom",(null===(t=a["@_localStates"])||void 0===t?void 0:t.selected)&&"btn-accent"),"data-tip":(null===(n=a["@_localStates"])||void 0===n?void 0:n.selected)?"Unselect":"Select",onClick:v,children:(0,s.jsx)(tS.G,{icon:(null===(o=a["@_localStates"])||void 0===o?void 0:o.selected)?tA.faXmarkCircle:tR.faCheckCircle})}),(0,s.jsx)("button",{className:"btn btn-xs btn-square tooltip tooltip-bottom","data-tip":"Delete",onClick:_,children:(0,s.jsx)(tS.G,{icon:tT.faTrash})})]}),d&&(0,s.jsx)("button",{className:"btn btn-xs btn-square tooltip tooltip-bottom","data-tip":"Restore",onClick:()=>f(i,u),children:(0,s.jsx)(tS.G,{icon:tB.faClockRotateLeft})}),c&&c({type:i,meta:a})]})}var tG=n(774),tW=n(1145),tq=n(5394),tV=n(9970),tH=n(6767);function tz(e){let{node:t,way:n,relation:o,filter:i,...a}=e;return i=i||(()=>!0),(0,s.jsxs)(tN,{children:[(t||[]).filter(e=>i(e,"node")).map(e=>(0,l.createElement)(tU,{...a,key:e["@_id"],meta:e,type:"node"})),(n||[]).filter(e=>i(e,"way")).map(e=>(0,l.createElement)(tU,{...a,key:e["@_id"],meta:e,type:"way"})),(o||[]).filter(e=>i(e,"relation")).map(e=>(0,l.createElement)(tU,{...a,key:e["@_id"],meta:e,type:"relation"}))]})}function tK(e){let{name:t,defaultOpen:n,forceOpen:o,forceClose:i,children:a}=e,[r,d]=(0,l.useState)(!n),c=!!o||!i&&!r;return(0,s.jsxs)("li",{className:"outline-list-item",children:[(0,s.jsxs)("span",{className:"flex flex-row",onClick:e=>{e.stopPropagation(),i||o||d(!r)},children:[(0,s.jsx)(tS.G,{icon:o?tH.faMinus:i?tV.faX:c?tW.faChevronDown:tq.faChevronRight}),(0,s.jsx)(tS.G,{icon:tG.faBars,className:"ml-1"}),(0,s.jsx)("span",{className:"ml-0 mr-auto",children:t})]}),c&&a]})}function tX(e){let t=e$(e=>e.meta.node);return(0,s.jsx)(tK,{name:"bus stop",children:(0,s.jsx)(tz,{...e,node:Object.values(t).filter(e=>ts(e.tag))})})}function tZ(e){let t=e$(e=>e.meta.relation);return(0,s.jsx)(tK,{name:"stop area",children:(0,s.jsx)(tz,{...e,relation:Object.values(t).filter(e=>tI(e.tag))})})}function tJ(e){let t=e$(e=>e.meta.node);return(0,s.jsx)(tK,{name:"stop position",children:(0,s.jsx)(tz,{...e,node:Object.values(t).filter(e=>tl(e.tag))})})}var tY=n(7724);function tQ(e){let{children:t}=e,[n,o]=(0,l.useState)(""),i=(e,t)=>""===n||`${t}-${JSON.stringify(e)}`.toLocaleLowerCase().includes(n.toLocaleLowerCase());return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("label",{className:"input input-xs input-bordered flex items-center gap-2 w-full mt-1 mx-auto",children:[(0,s.jsx)(tS.G,{icon:tY.faSearch}),(0,s.jsx)("input",{type:"text",className:"grow",placeholder:"Search",value:n,onChange:e=>o(e.target.value)})]}),(0,s.jsx)("div",{className:"outline-list flex-1 rounded overflow-scroll",children:(0,s.jsx)("ul",{className:"menu menu-xs",children:R(t).map((e,t)=>(0,s.jsxs)("div",{children:[" ",e({filter:i})]},t))})})]})}function t0(){return(0,s.jsxs)(tQ,{children:[e=>{let{filter:t}=e;return(0,s.jsx)(tX,{filter:t})},e=>{let{filter:t}=e;return(0,s.jsx)(tJ,{filter:t})},e=>{let{filter:t}=e;return(0,s.jsx)(tZ,{filter:t})}]})}function t1(e){return 0>Number(e["@_id"])}function t2(e){let{relation:t,way:n,node:o}=e$(e=>e.meta),i=(0,l.useMemo)(()=>Object.values(eO(t,t1)),[t]),a=(0,l.useMemo)(()=>Object.values(eO(n,t1)),[n]),r=(0,l.useMemo)(()=>Object.values(eO(o,t1)),[o]);return(0,s.jsx)(tK,{name:"created",children:(0,s.jsx)(tz,{...e,relation:i,way:a,node:r})})}let t3=e=>{let{left:t,right:n,bottom:o,top:i}=e;return e=>{let a=e=>{let{"@_lon":a,"@_lat":r}=e;return t<=a&&a<=n&&o<=r&&r<=i},r=t=>e.meta.node[t["@_ref"]];return{node:Object.entries(e.meta.node).filter(e=>{let[,t]=e;return a(t)}).reduce((e,t)=>({...e,[t[0]]:t[1]}),{}),way:Object.entries(e.meta.way).filter(e=>{let[,t]=e;return t.nd.map(r).some(a)}).reduce((e,t)=>({...e,[t[0]]:t[1]}),{}),relation:Object.entries(e.meta.relation).filter(e=>{let[,t]=e;return t.member.filter(e=>"node"===e["@_type"]&&r(e)).map(r).some(a)}).reduce((e,t)=>({...e,[t[0]]:t[1]}),{})}}};function t4(e){let t=e.activeRef;return t?{type:t.type,meta:e.meta[t.type][t.id]}:null}let t5=e=>t=>{let n=t.selectedRef;return n.length?n.filter(t=>t.type===e).map(n=>t.meta[e][n.id]):[]},t7=e=>e.deletedMeta;function t9(e){let{relation:t,way:n,node:o}=e$((0,tg.N)(t7)),i=(0,l.useMemo)(()=>Object.values(t),[t]),a=(0,l.useMemo)(()=>Object.values(n),[n]),r=(0,l.useMemo)(()=>Object.values(o),[o]);return(0,s.jsx)(tK,{name:"deleted",children:(0,s.jsx)(tz,{...e,relation:i,way:a,node:r,isDeleted:!0})})}function t8(e){return"modify"===e["@_action"]}function t6(e){let{relation:t,way:n,node:o}=e$(e=>e.meta),i=(0,l.useMemo)(()=>Object.values(eO(t,t8)),[t]),a=(0,l.useMemo)(()=>Object.values(eO(n,t8)),[n]),r=(0,l.useMemo)(()=>Object.values(eO(o,t8)),[o]);return(0,s.jsx)(tK,{name:"modified",children:(0,s.jsx)(tz,{...e,relation:i,way:a,node:r})})}function ne(){return(0,s.jsxs)(tQ,{children:[e=>{let{filter:t}=e;return(0,s.jsx)(t2,{filter:t})},e=>{let{filter:t}=e;return(0,s.jsx)(t6,{filter:t})},e=>{let{filter:t}=e;return(0,s.jsx)(t9,{filter:t})}]})}function nt(e){let t=e$(e=>e.meta.relation);return(0,s.jsx)(tK,{name:"route",children:(0,s.jsx)(tz,{...e,relation:Object.values(t).filter(e=>tL(e.tag))})})}function nn(e){let t=e$(e=>e.meta.relation);return(0,s.jsx)(tK,{name:"route master",children:(0,s.jsx)(tz,{...e,relation:Object.values(t).filter(e=>tF(e.tag))})})}function no(){return(0,s.jsxs)(tQ,{children:[e=>{let{filter:t}=e;return(0,s.jsx)(nt,{filter:t})},e=>{let{filter:t}=e;return(0,s.jsx)(nn,{filter:t})}]})}function ni(e){let t=e$((0,tg.N)(t4));return(0,s.jsx)(tK,{name:"active",forceOpen:!0,children:(0,s.jsx)(tz,{...e,node:(null==t?void 0:t.type)==="node"?[t.meta]:void 0,way:(null==t?void 0:t.type)==="way"?[t.meta]:void 0,relation:(null==t?void 0:t.type)==="relation"?[t.meta]:void 0,showMetaType:!0})})}var na=n(7886);function nr(e){let t=e$((0,tg.N)(t5("node"))),n=e$((0,tg.N)(t5("way"))),o=e$((0,tg.N)(t5("relation"))),i=e$(e=>e.selectFeature),a=(0,l.useCallback)(e=>{let{type:t,meta:n}=e;return(0,s.jsx)("button",{className:"btn btn-xs btn-square tooltip tooltip-bottom","data-tip":"Active",onClick:async e=>{e.stopPropagation(),console.debug("activating: ",t,n["@_id"]),i(t,n["@_id"],!1)},children:(0,s.jsx)(tS.G,{icon:na.faStarOfLife})})},[i]);return(0,s.jsx)(tK,{name:"selected",defaultOpen:!0,children:(0,s.jsx)(tz,{...e,node:t,way:n,relation:o,showMetaType:!0,children:a})})}function ns(){return(0,s.jsxs)(tQ,{children:[e=>{let{filter:t}=e;return(0,s.jsx)(ni,{filter:t})},e=>{let{filter:t}=e;return(0,s.jsx)(nr,{filter:t})}]})}function nl(e){let{width:t,height:n}=e,o=[{title:"Bus stop",tab:()=>(0,s.jsx)(t0,{})},{title:"Route",tab:()=>(0,s.jsx)(no,{})},{title:"Changes",tab:()=>(0,s.jsx)(ne,{})},{title:"Selected",tab:()=>(0,s.jsx)(ns,{})}],[i,a]=(0,l.useState)(0);return(0,s.jsxs)("div",{style:{width:t,height:n},className:"flex flex-col",children:[(0,s.jsx)("div",{role:"tablist",className:"tabs tabs-lifted tabs-xs",children:o.map((e,t)=>(0,s.jsx)("a",{onClick:()=>a(t),role:"tab",className:T("tab",t===i&&"tab-active"),children:e.title},t))}),(0,s.jsx)("div",{className:"outline-view flex flex-col bg-base-100 w-full px-1 flex-1 overflow-auto",children:o[i].tab()})]})}let nd=(0,l.memo)(e=>{let{initialValue:t,onCommit:n,...o}=e,[i,a]=(0,l.useState)(t||"");return(0,l.useEffect)(()=>{a(t||"")},[t]),(0,s.jsx)("input",{...o,value:i,onChange:e=>a(e.target.value),onKeyDown:e=>{"Enter"===e.key&&e.currentTarget.blur(),e.stopPropagation()},onBlur:()=>{n(i)}})}),nc=function(e){let{tags:t,setTags:n,commitChange:o}=e,i=M(t),a=(e,t)=>{o(),i[e]["@_k"]=t,n([...i])},r=(e,t)=>{o(),i[e]["@_v"]=t,n([...i])},l=e=>{let t=i.filter((t,n)=>n!==e);o(),n(t)};return(0,s.jsxs)("table",{className:"table table-xs w-full max-w-full overflow-x-scroll",children:[(0,s.jsx)("thead",{children:(0,s.jsxs)("tr",{children:[(0,s.jsx)("th",{children:"Key"}),(0,s.jsx)("th",{children:"Value"}),(0,s.jsx)("th",{children:"Actions"})]})}),(0,s.jsx)("tbody",{children:i.map((e,t)=>(0,s.jsxs)("tr",{children:[(0,s.jsx)("td",{children:(0,s.jsx)(nd,{type:"text",initialValue:e["@_k"],onCommit:e=>a(t,e),className:"input input-bordered input-xs rounded-md border max-w-xs"})}),(0,s.jsx)("td",{children:(0,s.jsx)(nd,{type:"text",initialValue:e["@_v"],onCommit:e=>r(t,e),className:"input input-bordered input-xs rounded-md border max-w-xs w-fit"})}),(0,s.jsx)("td",{children:(0,s.jsx)("button",{onClick:()=>l(t),className:"btn btn-error btn-xs",children:(0,s.jsx)(tS.G,{icon:tk.bLj})})})]},t))}),(0,s.jsx)("tfoot",{children:(0,s.jsx)("tr",{children:(0,s.jsx)("td",{colSpan:3,className:"flex gap-2",children:(0,s.jsx)("button",{onClick:()=>{o(),n([...i,{"@_k":"","@_v":""}])},className:"btn btn-primary btn-sm",children:"Add"})})})})]})},nu=function(e){let{meta:t}=e,n=E(t).filter(e=>{let n=t[e];return e.startsWith("@_")&&("string"==typeof n||"number"==typeof n)});return(0,s.jsx)("ul",{className:"menu menu-xs bg-200 rounded-box",children:n.map(e=>{let n=t[e];return(0,s.jsx)("li",{children:(0,s.jsxs)("span",{className:"select-text",children:[(0,s.jsx)("span",{className:"font-semibold",children:String(e).substring(2)}),(0,s.jsx)("span",{className:"ml-auto text-base-content",children:n.toString()})]})},e)})})};function nm(e){var t,n,o;let{type:i,id:a,showMetaType:r,children:d}=e,[c,u,m,p]=e$((0,tg.N)(e=>[e.meta[i][a],e.selectFeatureWithoutActive,e.unSelectFeature,e.loadFeature])),h=eW(e=>e.osmAPI.BASEURL),f=x(e=>e.setViewpoint),b=(0,l.useMemo)(()=>{var e;if(r&&(null==c?void 0:null===(e=c.tag)||void 0===e?void 0:e.length)){if("node"===i)return tc(c.tag);if("relation"===i)return t$(c.tag)}},[r,null==c?void 0:c.tag,i]),[g,y]=(0,l.useState)(!1),w=(0,l.useCallback)(async()=>{y(!0),await p(i,a,h),y(!1)},[p,i,a,h]),v=(0,l.useCallback)(e=>{e.stopPropagation(),"node"===i&&f({lat:c["@_lat"],lon:c["@_lon"]})},[c,f,i]),_=(0,l.useCallback)(e=>{var t;e.stopPropagation(),(null===(t=c["@_localStates"])||void 0===t?void 0:t.selected)?m(i,a):u(i,a,!1)},[a,c,u,i,m]),j=(0,l.useCallback)(e=>{e.stopPropagation(),w()},[w]);return c?(0,s.jsx)("div",{className:"flex text-xs flex-1 flex-row items-center px-1 ml-1 gap-1",children:(0,s.jsxs)(tM,{featuretype:i,id:a,metatype:b,fullname:td(c.tag),created:0>Number(c["@_id"]),deleted:"delete"===c["@_action"],modified:"modify"===c["@_action"],children:["node"===i&&(0,s.jsx)("button",{className:"btn btn-xs btn-square tooltip tooltip-bottom","data-tip":"Switch to position",onClick:v,children:(0,s.jsx)(tS.G,{icon:tC.faLocationDot})}),(0,s.jsx)("button",{className:T("btn btn-xs btn-square tooltip tooltip-bottom",(null===(t=c["@_localStates"])||void 0===t?void 0:t.selected)&&"btn-accent"),"data-tip":(null===(n=c["@_localStates"])||void 0===n?void 0:n.selected)?"Unselect":"Select",onClick:_,children:(0,s.jsx)(tS.G,{icon:(null===(o=c["@_localStates"])||void 0===o?void 0:o.selected)?tA.faXmarkCircle:tR.faCheckCircle})}),d&&d({type:i,id:a})]})}):(0,s.jsx)("div",{className:"flex text-xs flex-1 flex-row items-center px-1 ml-1 gap-1",children:(0,s.jsxs)(tM,{featuretype:i,id:a,fullname:"[not downloaded]",children:[g?(0,s.jsx)("span",{className:"loading loading-spinner loading-xs"}):(0,s.jsx)("button",{className:"btn btn-square btn-xs btn-success tooltip tooltip-bottom","data-tip":"Download feature",onMouseDown:j,children:(0,s.jsx)(tS.G,{icon:tk.q7m})}),d&&d({type:i,id:a})]})})}let np=function(e){let{id:t,type:n}=e,o=e$(e=>e.selectFeature),{relation:i,way:a}=e$((0,tg.N)(e=>e.meta)),r=E(i).filter(e=>Object.prototype.hasOwnProperty.call(i,e)).map(e=>i[e]),l=e=>{o("relation",e,!1)};return(0,s.jsx)("ul",{className:"menu menu-xs",children:r.filter(e=>R(e.member).some(e=>e["@_ref"]===t&&e["@_type"]===n||"node"===n&&("way"===e["@_type"]&&a[e["@_ref"]]&&R(a[e["@_ref"]].nd).some(e=>String(e["@_ref"])===t)||"relation"===e["@_type"]&&i[e["@_ref"]]&&R(i[e["@_ref"]].member).some(e=>e["@_ref"]===t)))).map(e=>(0,s.jsx)("li",{children:(0,s.jsx)("span",{onClick:()=>l(e["@_id"]),children:(0,s.jsx)(nm,{id:e["@_id"],type:"relation",showMetaType:!0})})},e["@_id"]))})},nh=function(e){let{id:t,type:n}=e,o=e$((0,tg.N)(e=>e.meta[n][t]["@_localStates"]));return(0,s.jsx)("div",{className:"flex flex-wrap gap-1",children:Object.entries(o).filter(e=>{let[,t]=e;return t}).map(e=>{let[t]=e;return(0,s.jsx)("span",{className:"badge badge-info badge-xs",children:t},t)})})},nf=function(e){let{id:t}=e,[n,o]=(0,l.useState)(0),i=e$((0,tg.N)(e=>e.meta.node[t])),a=e$(e=>e.modifyFeatureMetaNC),r=e$(e=>e.commit),d=(0,l.useMemo)(()=>[{title:"Info",tab:()=>(0,s.jsx)(nu,{meta:i})},{title:"Tags",tab:()=>(0,s.jsx)(nc,{tags:R(i.tag),setTags:e=>{a("node",t,t=>t.tag=e)},commitChange:r})},{title:"Members",tab:()=>(0,s.jsx)(np,{id:t,type:"node"})}],[i,t,a,R,r]);return i?(0,s.jsxs)("div",{className:"p-2 overflow-scroll",children:[(0,s.jsxs)("h3",{className:"text-base font-semibold mb-2",children:["[Node] ",td(i.tag)||i["@_id"]]}),(0,s.jsx)(nh,{id:t,type:"node"}),(0,s.jsx)("div",{role:"tablist",className:"tabs tabs-lifted tabs-xs py-4",children:d.map((e,t)=>(0,s.jsx)("a",{onClick:()=>o(t),role:"tab",className:T("tab",t===n&&"tab-active"),children:e.title},t))}),(0,s.jsx)("div",{className:"outline-view flex flex-col bg-base-100 w-full px-1 flex-1 overflow-auto",children:d[n].tab()})]}):null};function nx(e){let{member:t,memberToId:n,children:o,slotSelection:i}=e,[a,r]=(0,l.useState)(new Set);(0,l.useEffect)(()=>{r(e=>{let o=new Set;return t.forEach(t=>{e.has(n(t))&&o.add(n(t))}),o})},[t,n]);let d=(0,l.useMemo)(()=>{let e=e=>{r(t=>{let n=new Set(t);return n.has(e)?n.delete(e):n.add(e),n})};return t=>{let{m:o}=t;return(0,s.jsx)(s.Fragment,{children:(0,s.jsx)("input",{type:"checkbox",className:"checkbox ml-2",checked:a.has(n(o)),onChange:()=>e(n(o))})})}},[a,n]);return(0,s.jsxs)(s.Fragment,{children:[i({selected:a,children:(0,s.jsx)("input",{type:"checkbox",checked:a.size===t.length,onChange:()=>{a.size===t.length?r(new Set):r(new Set(t.map(n)))},className:"checkbox ml-2"})}),o({member:t,memberToId:n,slot:d})]})}function nb(e){let{id:t,type:n}=e,o=e$(e=>e.meta[n][t]),i=(0,l.useMemo)(()=>{var e;if(null==o?void 0:null===(e=o.tag)||void 0===e?void 0:e.length){if("node"===n)return tc(o.tag);if("relation"===n)return t$(o.tag)}},[null==o?void 0:o.tag,n]);return(0,s.jsx)(tM,{featuretype:n,id:t,metatype:i,fullname:td(o.tag),created:0>Number(o["@_id"]),deleted:"delete"===o["@_action"],modified:"modify"===o["@_action"]})}let ng=function(e){let{handelInsertTop:t,handelIntertBottom:n,handelInsertAtActive:o}=e,i=e$((0,tg.N)(e=>e.selectedRef)),a=(0,l.useCallback)(e=>`${e.type}-${e.id}`,[]),r=(0,l.useRef)(new Set),d=()=>i.filter(e=>r.current.has(a(e))),c=(0,l.useCallback)(e=>{let{member:t,memberToId:n,slot:o}=e;return t.map(e=>(0,s.jsxs)("div",{className:"flex flex-row gap-1 px-2 mt-1",children:[(0,s.jsx)(nb,{...e}),o({m:e})]},n(e)))},[]);return(0,s.jsxs)("div",{className:"flex flex-row justify-center p-2 rounded-md",children:[(0,s.jsxs)("div",{className:"join join-vertical mr-2",children:[(0,s.jsx)("button",{type:"button",className:"btn btn-xs join-item",onClick:()=>{t(d())},children:"InsTop"}),(0,s.jsx)("button",{type:"button",className:"btn btn-xs join-item",onClick:()=>{o(d())},children:"InsAct"}),(0,s.jsx)("button",{type:"button",className:"btn btn-xs join-item",onClick:()=>{n(d())},children:"InsBtm"})]}),(0,s.jsx)("div",{className:"bg-base-200 text-xs rounded max-h-full",children:(0,s.jsx)(nx,{member:i,memberToId:a,slotSelection:e=>{let{selected:t,children:n}=e;return r.current=t,(0,s.jsxs)("div",{className:"flex flex-row px-2 py-1",children:[(0,s.jsx)("h3",{className:"text text-sm font-semibold",children:"selected Items to insert"}),(0,s.jsx)("div",{className:"ml-auto"}),n]})},children:c})})]})};var ny=n(6513),nw=n(5684),nv=n(5587),n_=n(4285),nj=n(8252);let nN=function(e){let{id:t,element:n="div",children:o,style:i,...a}=e,{attributes:r,listeners:l,setNodeRef:d,transform:c,transition:u}=(0,nv.nB)({id:t}),m={transform:n_.ux.Transform.toString(c),transition:u,...i};return(0,s.jsxs)(n,{ref:d,className:"flex flex-row bg-base-200 rounded border pl-1",style:m,...a,children:[(0,s.jsx)("button",{...l,...r,className:"btn btn-ghost btn-xs my-auto inline-block",children:(0,s.jsx)(tS.G,{icon:nj.faGripVertical})}),o]})},nS=function(e){let{memberToId:t,member:n,onDragEnd:o,onDragStart:i,children:a}=e,r=(0,nw.Dy)((0,nw.VT)(nw.we),(0,nw.VT)(nw.Lg,{coordinateGetter:nv.is})),[d,c]=(0,l.useState)(),u=(0,l.useMemo)(()=>n.map(e=>({id:t(e),member:e})),[n,t]),m=(0,l.useCallback)(e=>{let{id:t,member:n,index:o}=e;return(0,s.jsx)(nN,{id:t,children:a({member:n,index:o})},t)},[a]);return(0,s.jsxs)(nw.LB,{sensors:r,collisionDetection:nw.pE,onDragStart:function(e){var t;let{active:n}=e;console.debug("drag memeber start:",n);let o=null===(t=u.find(e=>e.id===n.id))||void 0===t?void 0:t.member;if(!o)throw Error(`in Drag list got invalid active object ${JSON.stringify(n)}`);c(o),i(o)},onDragEnd:function(e){let{active:t,over:n}=e;if(console.debug("drag memeber end:",t,n),n&&t.id!==n.id){let e=u.findIndex(e=>e.id===t.id),i=u.findIndex(e=>e.id===n.id);o((0,nv.Rp)(u,e,i).map(e=>e.member))}c(void 0)},children:[(0,s.jsx)(nv.Fo,{items:u,strategy:nv.qw,children:u.map((e,t)=>m({id:e.id,member:e.member,index:t}))}),(0,s.jsx)(nw.y9,{children:d?(0,s.jsxs)("div",{className:"flex bg-base-200 rounded-sm pl-1",children:[(0,s.jsx)("button",{className:"btn btn-ghost btn-xs my-auto",children:(0,s.jsx)(tS.G,{icon:nj.faGripVertical})}),a({member:d,isDragOverlay:!0,index:-1})]}):null})]})};function nk(e){let{member:t,isDragOverlay:n,slot:o,index:i,children:a}=e;return(0,s.jsx)(s.Fragment,{children:a({member:t,children:o({m:t}),overlay:n,index:i})})}function nM(e){let{member:t,memberToId:n,children:o,slotSelection:i,...a}=e,r=(0,l.useCallback)(e=>{let{member:t,memberToId:n,slot:i}=e;return(0,s.jsx)(nS,{...a,member:t,memberToId:n,children:e=>(0,s.jsx)(nk,{...e,slot:i,children:o})})},[o,a]);return(0,s.jsx)(nx,{member:t,memberToId:n,slotSelection:i,children:r})}var nE=n(767);function nC(e){let{onDelete:t,member:n,memberToId:o,...i}=e,a=e$(e=>e.loadFeatureBatch),r=eW(e=>e.osmAPI.BASEURL),[d,c]=(0,l.useState)(!1),u=(0,l.useRef)(1),m=(0,l.useCallback)(()=>u.current++,[u]),p=(0,l.useMemo)(()=>n.map(e=>({...e,uniqueIdentifier:m()})),[m,n]),h=(0,l.useCallback)(e=>`${o(e)}_AT_LIST_${e.uniqueIdentifier}`,[o]),f=(0,l.useCallback)(e=>{let{selected:n,children:o}=e;return(0,s.jsxs)("div",{className:"flex flex-row p-1 rounded",children:[(0,s.jsx)("div",{className:"mr-auto",children:"Members"}),(0,s.jsx)("button",{className:"btn btn-square btn-xs btn-error tooltip tooltip-bottom","data-tip":"Remove Selected member from list",onMouseDown:e=>{e.stopPropagation();let o=p.filter(e=>!n.has(h(e)));t(p,o)},children:(0,s.jsx)(tS.G,{icon:ny.faDeleteLeft})}),(0,s.jsx)("button",{className:"btn btn-square btn-xs btn-accent tooltip tooltip-bottom","data-tip":"Download selected member of this list",disabled:d,onMouseDown:async e=>{e.stopPropagation(),c(!0),await a(p.filter(e=>n.has(h(e))).map(e=>e["@_type"]?{type:e["@_type"],id:e["@_ref"]}:{type:"node",id:e["@_ref"]}),r),c(!1)},children:d?(0,s.jsx)("span",{className:"loading loading-spinner loading-xs"}):(0,s.jsx)(tS.G,{icon:nE.faDownload})}),o]})},[r,a,p,h,t,d,c]);return(0,s.jsx)(nM,{...i,member:p,memberToId:h,slotSelection:f})}var nR=n(1746),nT=n(7319);let nO=function(e){let{id:t}=e,[n,o]=(0,l.useState)(0),i=e$((0,tg.N)(e=>e.meta.way[t])),a=e$(e=>e.modifyFeatureMetaNC),r=e$(e=>e.commit),[d,c]=(0,l.useState)(void 0),u=(0,l.useCallback)(e=>{let{member:t,children:n}=e;return(0,s.jsx)(nm,{id:t["@_ref"],type:"node",children:()=>{let e=(null==d?void 0:d.id)===t["@_ref"];return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("button",{className:T("btn btn-square btn-xs tooltip tooltip-bottom",e&&"btn-accent"),"data-tip":"Mark as local active place to insert",onMouseDown:n=>{n.stopPropagation(),e?c(void 0):c({id:t["@_ref"],type:"node"})},children:(0,s.jsx)(tS.G,{icon:e?nT.faCircle:nR.faCircle})}),n]})}})},[null==d?void 0:d.id]),m=(0,l.useCallback)(e=>`nd-${e["@_ref"]}`,[]);if(!i)return null;function p(){r()}function h(e){a("way",t,t=>{t.nd=e})}function f(e){a("way",t,t=>{t.nd=e})}let x=e=>e.filter(e=>"node"===e.type).map(e=>({"@_ref":e.id})),b=e=>{console.log("Insert at Top: ",e),r(),a("way",t,t=>{t.nd=[...x(e),...R(i.nd)]})},g=e=>{console.log("Insert at Bottom: ",e),r(),a("way",t,t=>{t.nd=[...R(i.nd),...x(e)]})},y=e=>{if(console.log("Insert at Active: ",e),d){let n=[...R(i.nd)],o=n.findIndex(e=>e["@_ref"]===d.id);n.splice(o+1,0,...x(e)),r(),a("way",t,e=>{e.nd=n})}else g(e)},w=(0,l.useMemo)(()=>[{title:"Info",tab:()=>(0,s.jsx)(nu,{meta:i})},{title:"Tags",tab:()=>(0,s.jsx)(nc,{tags:R(i.tag),setTags:e=>{a("way",t,t=>t.tag=e)},commitChange:r})},{title:"Members",tab:()=>(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("div",{className:"flex flex-row",children:[(0,s.jsx)("div",{className:"bg-base-200",children:(0,s.jsx)(nC,{member:i.nd,memberToId:m,onDragStart:p,onDragEnd:h,onDelete:(e,t)=>f(t),children:u})}),(0,s.jsx)("div",{className:"",children:(0,s.jsx)(ng,{handelInsertTop:b,handelIntertBottom:g,handelInsertAtActive:y})})]}),(0,s.jsx)(np,{id:t,type:"way"})]})}],[i,t,r,a,R,m,p,h,f,u,b,g,y]);return(0,s.jsxs)("div",{className:"p-2 overflow-scroll",children:[(0,s.jsxs)("h3",{className:"text-base font-semibold mb-2",children:["[Way] ",td(i.tag)||i["@_id"]]}),(0,s.jsx)(nh,{id:t,type:"way"}),(0,s.jsx)("div",{role:"tablist",className:"tabs tabs-lifted tabs-xs py-4",children:w.map((e,t)=>(0,s.jsx)("a",{onClick:()=>o(t),role:"tab",className:T("tab",t===n&&"tab-active"),children:e.title},t))}),(0,s.jsx)("div",{className:"outline-view flex flex-col bg-base-100 w-full px-1 flex-1 overflow-auto",children:w[n].tab()})]})},nP=(0,l.memo)(e=>{let{initialValue:t,onCommit:n}=e,[o,i]=(0,l.useState)(t||"");return(0,l.useEffect)(()=>{i(t||"")},[t]),(0,s.jsx)("input",{className:"grow",type:"text",placeholder:"role of member",value:o,onChange:e=>i(e.target.value),onKeyDown:e=>{"Enter"===e.key&&e.currentTarget.blur(),e.stopPropagation()},onBlur:()=>{n(o)}})});var nD=n(1329),nA=n(9323),nI=n(1730);function nL(e,t){return e["@_ref"]===t["@_ref"]}function nF(e){var t,n;let{member:o,index:i}=e,a=e$(e=>e.meta.way),r=a[o[i]["@_ref"]],l=a[null===(t=o[i-1])||void 0===t?void 0:t["@_ref"]]||void 0,d=a[null===(n=o[i+1])||void 0===n?void 0:n["@_ref"]]||void 0,c=l&&r&&nL(l.nd[l.nd.length-1],r.nd[0]),u=d&&r&&nL(r.nd[r.nd.length-1],d.nd[0]);return c&&u?(0,s.jsx)("div",{className:"tooltip tooltip-bottom","data-tip":"Connected to both sides",children:(0,s.jsx)(tS.G,{icon:nD.faArrowsUpDown})}):c?(0,s.jsx)("div",{className:"tooltip tooltip-bottom","data-tip":"Connected to previous way",children:(0,s.jsx)(tS.G,{icon:nA.faArrowUp})}):u?(0,s.jsx)("div",{className:"tooltip tooltip-bottom","data-tip":"Connected to next way",children:(0,s.jsx)(tS.G,{icon:nI.faArrowDown})}):(0,s.jsx)("div",{className:"tooltip tooltip-bottom","data-tip":"Not connected to any way, or not downloaded",children:(0,s.jsx)(tS.G,{icon:tH.faMinus})})}let n$=function(e){let{id:t}=e,[n,o]=(0,l.useState)(0),i=e$((0,tg.N)(e=>e.meta.relation[t])),a=e$(e=>e.modifyFeatureMetaNC),r=e$(e=>e.commit),[d,c]=(0,l.useState)(void 0),u=(0,l.useCallback)((e,n,o)=>{console.debug("edit",e,n,o),r(),a("relation",t,t=>{t.member=R(i.member).map(t=>{if(t["@_type"]===e&&t["@_ref"]===n){let e=M(t);return e["@_role"]=o,e}return t})})},[r,t,i.member,a]),m=(0,l.useCallback)(e=>`${e["@_type"]}-${e["@_ref"]}`,[]),p=(0,l.useCallback)(e=>{let{member:t,children:n,overlay:o,index:a}=e;return(0,s.jsx)(nm,{id:t["@_ref"],type:t["@_type"],children:()=>{let e=(null==d?void 0:d.id)===t["@_ref"]&&d.type===t["@_type"];return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("button",{className:T("btn btn-square btn-xs tooltip tooltip-bottom",e&&"btn-accent"),"data-tip":"Mark as local active place to insert",onMouseDown:n=>{n.stopPropagation(),e?c(void 0):c({id:t["@_ref"],type:t["@_type"]})},children:(0,s.jsx)(tS.G,{icon:e?tk.diR:nR.faCircle})}),(0,s.jsx)("div",{className:"w-3",children:!o&&"way"===t["@_type"]&&(0,s.jsx)(nF,{member:i.member,index:a})}),(0,s.jsxs)("label",{className:"input input-xs input-bordered ml-1 flex items-center gap-1",children:["Role:",(0,s.jsx)(nP,{initialValue:t["@_role"],onCommit:e=>u(t["@_type"],t["@_ref"],e)})]}),n]})}})},[u,d,i.member]);if(!i)return null;function h(){r()}function f(e){a("relation",t,t=>{t.member=e})}function x(e){r(),a("relation",t,t=>{t.member=e})}let b=e=>e.map(e=>({"@_ref":e.id,"@_type":e.type})),g=e=>{console.log("Insert at Top: ",e),r(),a("relation",t,t=>{t.member=[...b(e),...R(t.member)]})},y=e=>{console.log("Insert at Bottom: ",e),r(),a("relation",t,t=>{t.member=[...R(t.member),...b(e)]})},w=e=>{if(console.log("Insert at Active: ",e),d){let n=[...R(i.member)],o=n.findIndex(e=>e["@_ref"]===d.id&&e["@_type"]===d.type);n.splice(o+1,0,...b(e)),r(),a("relation",t,e=>{e.member=n})}else y(e)},v=(0,l.useMemo)(()=>[{title:"Info",tab:()=>(0,s.jsx)(nu,{meta:i})},{title:"Tags",tab:()=>(0,s.jsx)(nc,{tags:R(i.tag),setTags:e=>{a("relation",t,t=>t.tag=e)},commitChange:r})},{title:"Members",tab:()=>(0,s.jsxs)("div",{className:"flex flex-row relative",children:[(0,s.jsx)("div",{className:"bg-base-200",children:(0,s.jsx)(nC,{member:i.member,memberToId:m,onDragStart:h,onDragEnd:f,onDelete:(e,t)=>x(t),children:p})}),(0,s.jsx)("div",{className:"",children:(0,s.jsx)(ng,{handelInsertTop:g,handelIntertBottom:y,handelInsertAtActive:w})})]})}],[i,t,r,a,R,m,h,f,x,p,g,y,w]);return(0,s.jsxs)("div",{className:"p-2 overflow-scroll",children:[(0,s.jsxs)("h3",{className:"text-base font-semibold mb-2",children:["[Relation] ",td(i.tag)||i["@_id"]]}),(0,s.jsx)(nh,{id:t,type:"relation"}),(0,s.jsx)("div",{role:"tablist",className:"tabs tabs-lifted tabs-xs py-4",children:v.map((e,t)=>(0,s.jsx)("a",{onClick:()=>o(t),role:"tab",className:T("tab",t===n&&"tab-active"),children:e.title},t))}),(0,s.jsx)("div",{className:"outline-view flex flex-col bg-base-100 w-full px-1 flex-1 overflow-auto",children:v[n].tab()})]})},nB=function(e){let{width:t,height:n}=e,o=e$(e=>e.activeRef);return(0,s.jsx)("div",{style:{width:t,height:n,maxWidth:t,maxHeight:n},className:"property-view flex flex-col rounded bg-base-100",children:o?"node"===o.type?(0,s.jsx)(nf,{id:o.id}):"way"===o.type?(0,s.jsx)(nO,{id:o.id}):"relation"===o.type?(0,s.jsx)(n$,{id:o.id}):(0,s.jsxs)("div",{children:["Unknown type for item ",JSON.stringify(o)]}):(0,s.jsx)("div",{children:"Please active some component to show prop edit view"})})};function nU(){let e=(0,eq.Y0)(),t=x(e=>e.setStageApp);return(0,l.useEffect)(()=>(globalThis.__PIXI_APP__=e,e.stage.hitArea=e.screen,t(e),()=>{globalThis.__PIXI_APP__=void 0,t(void 0)}),[e,t]),null}let nG=function(e){let{width:t,height:n,children:o,...i}=e,a=x(e=>e.setStage);return(0,l.useEffect)(()=>{a(t,n)},[t,n,a]),(0,s.jsxs)(eq.Hf,{width:t,height:n,options:{background:"#1099bb"},...i,children:[o,(0,s.jsx)(nU,{})]})};function nW(e){let{width:t}=e;return(0,s.jsx)("div",{className:"slot-bottom absolute inset-x-0 bottom-0 flex flex-row align-middle justify-center",style:{width:t},children:(0,s.jsx)("span",{className:"text-base-content bg-base-300 px-2 rounded",children:"data\xa9openstreetmap contributor"})})}function nq(e){let{width:t,height:n}=e,o=(0,l.useRef)(new W({meta:e$,view:x,settings:eW}));return(0,l.useEffect)(()=>{let e=e=>o.current.transform(e);return document.addEventListener("keydown",e),()=>document.removeEventListener("keydown",e)},[]),(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(nG,{width:t,height:n,options:{background:"#1099bb"},onContextMenu:e=>e.preventDefault(),onMouseDown:e=>{o.current.transform(e)},onPointerMove:e=>{o.current.transform(e)},onMouseUp:e=>{o.current.transform(e)},onWheel:e=>{o.current.transform(e)},children:[(0,s.jsx)(eH,{width:t,height:n}),(0,s.jsx)(tb,{width:t,height:n,stateMachine:o.current})]}),(0,s.jsx)(nW,{width:t}),(0,s.jsx)("div",{className:"slot-top absolute inset-x-0 top-0 flex flex-row align-middle justify-center",style:{width:t},children:(0,s.jsx)(tw,{stateMachine:o.current})})]})}let nV=function(e){let{width:t,height:n}=e;return(0,s.jsxs)(tj,{width:t,height:n,axis:"x",initial:t/4*3,children:[e=>(0,s.jsx)(nq,{...e}),e=>(0,s.jsxs)(tj,{...e,axis:"y",children:[e=>(0,s.jsx)(nl,{...e}),e=>(0,s.jsx)(nB,{...e})]})]})};var nH=n(9416),nz=n(6349),nK=n(2148),nX=n(2731);function nZ(e){let{open:t,onClose:n}=e,{updateSettingsAction:o,...i}=eW(),[a,r]=(0,l.useState)(i),d=e$(e=>e.reset);return(0,s.jsx)("div",{className:T("modal",t&&"modal-open"),children:(0,s.jsxs)("div",{className:"modal-box",children:[(0,s.jsx)("h3",{className:"font-bold text-lg",children:"Change Settings"}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"label",children:(0,s.jsx)("span",{className:"label-text",children:"OSM API Base URL"})}),(0,s.jsx)("input",{type:"text",value:a.osmAPI.BASEURL,onChange:e=>r({...a,osmAPI:{...a.osmAPI,BASEURL:e.target.value}}),className:"input input-bordered w-full"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"label",children:(0,s.jsx)("span",{className:"label-text",children:"OSM API Tile Source"})}),(0,s.jsx)("input",{type:"text",value:a.osmAPI.TILE_SOURCE,onChange:e=>r({...a,osmAPI:{...a.osmAPI,TILE_SOURCE:e.target.value}}),className:"input input-bordered w-full"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"label",children:(0,s.jsx)("span",{className:"label-text",children:"Max Zoom Level"})}),(0,s.jsx)("input",{type:"number",value:a.view.MAX_ZOOM,onChange:e=>r({...a,view:{...a.view,MAX_ZOOM:parseFloat(e.target.value)}}),className:"input input-bordered w-full"})]}),(0,s.jsx)("button",{className:"btn btn-error mt-4",onClick:d,children:"Reast All Data (All data will lost)"}),(0,s.jsxs)("div",{className:"modal-action",children:[(0,s.jsx)("button",{className:"btn btn-ghost",onClick:n,children:"Cancel"}),(0,s.jsx)("button",{className:"btn",onClick:()=>{o(a),n()},children:"Save"})]})]})})}function nJ(){let[e,t]=e$((0,tg.N)(e=>[e.autoload,e.setAutoloadNC])),n=(0,l.useCallback)(()=>t(()=>!e),[e,t]);return(0,s.jsx)("li",{className:"tooltip tooltip-left","data-tip":"Auto load OSM data on drag: "+(e?"Enabled":"Disabled"),children:(0,s.jsx)("a",{onClick:n,className:T(e&&"active"),children:(0,s.jsx)(tS.G,{icon:nH.faA})})})}function nY(){let{viewpoint:e,zoom:t,height:n,width:o}=x(),i=e$((0,tg.N)(e=>e.loadbbox)),a=eW(e=>e.osmAPI.BASEURL),[r,d]=(0,l.useState)(!1),c=(0,l.useCallback)(async()=>{r||(d(!0),await i({width:o,height:n,zoom:t,viewpoint:e},a),d(!1))},[a,n,i,e,o,t,r,d]);return(0,s.jsx)("li",{className:T("tooltip tooltip-left",r&&"disabled"),"data-tip":"Load OSM data on current screen",children:(0,s.jsx)("a",{onClick:c,children:r?(0,s.jsx)("span",{className:"loading loading-spinner loading-xs h-[14px]"}):(0,s.jsx)(tS.G,{icon:nz.faDownLong})})})}function nQ(){return(0,s.jsx)("li",{className:"tooltip tooltip-left","data-tip":"Export with JSOM format",children:(0,s.jsx)("a",{onClick:()=>{let{meta:e,deletedMeta:t,bbox:n}=e$.getState(),o=new Blob([ty(e,t,n)],{type:"application/xml"}),i=document.createElement("a");i.href=URL.createObjectURL(o),i.download="exported_data.osm",i.click(),URL.revokeObjectURL(i.href)},children:(0,s.jsx)(tS.G,{icon:nK.faFileExport})})})}function n0(){let[e,t]=(0,l.useState)(!1);return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("li",{className:"tooltip tooltip-left","data-tip":"Change settings",onClick:()=>t(!0),children:(0,s.jsx)("a",{children:(0,s.jsx)(tS.G,{icon:nX.faGear})})}),(0,s.jsx)(nZ,{open:e,onClose:()=>t(!1)})]})}function n1(){return(0,s.jsxs)("ul",{className:"menu menu-horizontal",children:[(0,s.jsx)(nJ,{}),(0,s.jsx)(nY,{}),(0,s.jsx)(nQ,{}),(0,s.jsx)(n0,{})]})}function n2(e){let{className:t=""}=e,{appearance:n,updateSettingsAction:o}=eW(),i=n.theme,a=()=>window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light",r=(0,l.useCallback)(()=>{let e=["light","dark","system"],t=e[(e.indexOf(i)+1)%e.length];o({appearance:{...n,theme:t}})},[i,n,o]);return(0,l.useEffect)(()=>{let e="system"===i?a():i;document.documentElement.setAttribute("data-theme",e)},[i]),(0,s.jsx)("button",{onClick:r,className:`btn btn-ghost btn-circle ${t}`,children:(0,s.jsx)(tS.G,{icon:"dark"===i?tk.DBF:"light"===i?tk.enB:tk.tc$})})}function n3(){return(0,s.jsx)("div",{className:"tooltip tooltip-left mx-2","data-tip":"Toggle theme",children:(0,s.jsx)(n2,{className:"btn-sm"})})}function n4(e){let{height:t,leftSlot:n}=e;return(0,s.jsxs)("nav",{className:"navbar p-0 bg-base-100 overflow-hidden border-b-2 border-b-base-300",style:{height:t,maxHeight:t,minHeight:t},children:[(0,s.jsx)("div",{className:"flex-1",children:n}),(0,s.jsxs)("div",{className:"flex-none",children:[(0,s.jsx)(n1,{}),(0,s.jsx)(n3,{})]})]})}var n5=n(6031),n7=n(8409),n9=n(7267),n8=n(468);class n6 extends P{constructor(e,t){super(e),(0,k._)(this,"idle",void 0),(0,k._)(this,"mousedown",void 0),(0,k._)(this,"draging",void 0),this.idle=new O("select-idle"),this.mousedown=new O("select-mousedown"),this.draging=new O("select-dragging"),this.entry=this.idle,this.current=this.idle,this.accept=[this.idle],this.idle.appendNext(this.mousedown,{transform:e=>{let t=this.context;return"mousedown"===e.type&&!!e.shiftKey&&(console.debug("BatchSelectStateMachine: transition from idle to mousedown"),t.from=D(e.clientX,e.clientY,t),!0)}}),this.mousedown.appendNext(this.idle,{transform:e=>{let t=this.context;return!!["mouseup","mouseupoutside","pointerup","pointerupoutside"].includes(e.type)&&(console.debug("BatchSelectStateMachine: transition from mousedown to idle"),t.from=void 0,!0)}}),this.mousedown.appendNext(this.draging,{transform:e=>{let t=this.context;if("pointermove"===e.type){console.debug("BatchSelectStateMachine: start dragging");let{clientX:n,clientY:o}=e;return x.getState().setSelectionRect({from:t.from,to:D(n,o,t)}),!0}return!1}}),this.draging.appendNext(this.idle,{transform:e=>{if(["mouseup","mouseupoutside","pointerup","pointerupoutside"].includes(e.type)){if(console.debug("BatchSelectStateMachine: drag canceled, back to idle"),x.getState().setSelectionRect(),null==t?void 0:t.onSelectRect){let{clientX:n,clientY:o}=e;t.onSelectRect({from:this.context.from,to:D(n,o,this.context)},e)}return this.context.from=void 0,!0}return!1}}),this.draging.appendNext(this.draging,{transform:e=>{let t=this.context;if("pointermove"===e.type){console.debug("BatchSelectStateMachine: continue dragging");let{clientX:n,clientY:o}=e;return x.getState().setSelectionRect({from:t.from,to:D(n,o,t)}),!0}return!1}})}}class oe extends P{constructor(e,{onRightClick:t,onLeftClick:n,onHoverExit:o,onHoverStart:i,hoverable:a,clickable:r,dragable:s,selectable:l}){super(e),(0,k._)(this,"idle",void 0),(0,k._)(this,"componentHover",void 0),(0,k._)(this,"componentMousedown",void 0),(0,k._)(this,"pointDrag",void 0),this.idle=new O("pt-bus-component-idle"),this.componentHover=new O("pt-bus-component-hover"),this.componentMousedown=new O("pt-bus-component-mousedown"),this.pointDrag=new O("pt-bus-component-drag"),this.entry=this.idle,this.current=this.idle,this.accept=[this.idle],this.idle.appendNext(this.componentHover,{transform:e=>{let t=this.context;if(["pointerover","pointerenter"].includes(e.type)&&"componentTarget"in e&&e.componentTarget&&a(e.componentTarget,this.context)){t.componentTarget=e.componentTarget;let{id:n,type:o}=t.componentTarget;console.log("BusComponentStateMachine: component hover triggered",o,n);let{modifyFeatureStateNC:a}=t.store.meta.getState();return a(o,n,e=>e.hovered=!0),i&&i(t.componentTarget,e),!0}return!1}}),this.componentHover.appendNext(this.componentMousedown,{transform:e=>{let t=this.context;if("mousedown"===e.type&&t.componentTarget&&r(t.componentTarget,t)){console.log("BusComponentStateMachine: transition to "+this.componentMousedown.name);let{id:n,type:i}=t.componentTarget,{modifyFeatureStateNC:a}=t.store.meta.getState();return a(i,n,e=>e.hovered=!1),o&&o(t.componentTarget,e),!0}return!1}}),this.componentHover.appendNext(this.idle,{transform:e=>{let t=this.context;if(["pointerleave","pointerout"].includes(e.type)&&t.componentTarget){console.log("BusComponentStateMachine: transition to idle");let{id:n,type:i}=t.componentTarget,{modifyFeatureStateNC:a}=t.store.meta.getState();return a(i,n,e=>e.hovered=!1),o&&o(t.componentTarget,e),t.componentTarget=void 0,!0}return!1}}),this.componentMousedown.appendNext(this.pointDrag,{transform:e=>{var t;let n=this.context;if("pointermove"===e.type&&"node"===(null===(t=n.componentTarget)||void 0===t?void 0:t.type)&&s(n.componentTarget,n)){console.log("BusComponentStateMachine: start dragging");let{clientX:t,clientY:o}=e,{commit:i}=n.store.meta.getState();return i(),A(t,o,n),!0}return!1}}),this.componentMousedown.appendNext(this.idle,{transform:e=>{let o=this.context;if(("mouseup"===e.type||"mouseupoutside"===e.type)&&o.componentTarget){if(e.button===L.RIGHT&&t?t(o.componentTarget,e):e.button===L.LEFT&&n&&n(o.componentTarget,e),l(o.componentTarget,o)){let{selectFeature:t}=o.store.meta.getState(),{id:n,type:i}=o.componentTarget;if("string"==typeof n)t(i,n,!e.shiftKey),console.log("selected id",n,o.store.meta.getState().selectFeature);else throw Error(`id ${n} is invalid for component`)}return o.componentTarget=void 0,!0}return!1}}),this.pointDrag.appendNext(this.idle,{transform:e=>("mouseupoutside"===e.type||"mouseup"===e.type)&&(console.log("BusComponentStateMachine: drag canceled, back to idle"),this.context.componentTarget=void 0,!0)}),this.pointDrag.appendNext(this.pointDrag,{transform:e=>{if("pointermove"===e.type){let{clientX:t,clientY:n}=e;return A(t,n,this.context),!0}return!1}})}}class ot extends P{transform(e){"mousedown"===e.type&&(this.menus.busStop({x:0,y:0,open:!1}),this.menus.stopPosition({x:0,y:0,open:!1})),super.transform(e)}constructor(e,t){super(e),(0,k._)(this,"idle",void 0),(0,k._)(this,"mapViewSubMachine",void 0),(0,k._)(this,"busStopEditSubMachine",void 0),(0,k._)(this,"undoRedo",void 0),(0,k._)(this,"batchSelect",void 0),(0,k._)(this,"menus",void 0),this.menus=t;let n=e=>"node"===e.type;this.idle=new O("pt-edit-idle"),this.mapViewSubMachine=new F(e,{rightClickHandeler:e=>{this.menus.busStop({...D(e.clientX,e.clientY,this.context),open:!0}),this.menus.stopPosition({x:0,y:0,open:!1})}}),this.busStopEditSubMachine=new oe(e,{onRightClick:(e,t)=>{this.menus.stopPosition({...D(t.clientX,t.clientY,this.context),feature:e,open:!0})},hoverable:e=>"way"===e.type||"node"===e.type,clickable:e=>"way"===e.type||"node"===e.type,dragable:(e,t)=>{let n=t.store.meta.getState().meta[e.type][e.id].tag||[];return"node"===e.type&&(ts(n)||tl(n))},selectable:n}),this.undoRedo=new U(e),this.batchSelect=new n6(e,{onSelectRect:(e,t)=>{let{viewpoint:o,zoom:i,width:a,height:r}=this.context.store.view.getState(),s=N(o,i,a,r,e),l=this.context.store.meta.getState(),d=t3(s)(l);console.debug("get feature group ",d),t.ctrlKey||l.clearSelect(),Object.entries(d.node).filter(e=>{let[,t]=e;return n({id:t["@_id"],type:"node"},this.context)}).forEach(e=>{let[,t]=e;return l.selectFeature("node",t["@_id"],!1)})}}),this.entry=this.idle,this.current=this.idle,this.accept=[this.idle],this.idle.appendNext(this.mapViewSubMachine,{isEpsilon:!0}),this.idle.appendNext(this.busStopEditSubMachine,{isEpsilon:!0}),this.idle.appendNext(this.undoRedo,{isEpsilon:!0}),this.idle.appendNext(this.batchSelect,{isEpsilon:!0}),this.mapViewSubMachine.appendNext(this.idle,{isEpsilon:!0}),this.busStopEditSubMachine.appendNext(this.idle,{isEpsilon:!0}),this.undoRedo.appendNext(this.idle,{isEpsilon:!0}),this.batchSelect.appendNext(this.idle,{isEpsilon:!0})}}function on(e){let{type:t,id:n,showMetaType:o,children:i}=e,a=e$((0,tg.N)(e=>e.meta[t][n])),r=(0,l.useMemo)(()=>{var e;if(o&&(null==a?void 0:null===(e=a.tag)||void 0===e?void 0:e.length)){if("node"===t)return tc(a.tag);if("relation"===t)return t$(a.tag)}},[o,null==a?void 0:a.tag,t]);return(0,s.jsx)("div",{className:"flex text-xs flex-1 flex-row items-center px-1 ml-1 gap-1",children:(0,s.jsx)(tM,{featuretype:t,id:n,metatype:r,fullname:td(a.tag),created:0>Number(a["@_id"]),deleted:"delete"===a["@_action"],modified:"modify"===a["@_action"],children:i&&i({type:t,id:n})})})}function oo(e){let{onDelete:t,member:n,memberToId:o,...i}=e,a=(0,l.useRef)(1),r=(0,l.useCallback)(()=>a.current++,[a]),d=(0,l.useMemo)(()=>n.map(e=>({...e,uniqueIdentifier:r()})),[r,n]),c=(0,l.useCallback)(e=>`${o(e)}_AT_LIST_${e.uniqueIdentifier}`,[o]),u=(0,l.useCallback)(e=>{let{selected:n,children:o}=e;return(0,s.jsxs)("div",{className:"flex flex-row p-1 rounded",children:[(0,s.jsx)("div",{className:"mr-auto",children:"Members"}),(0,s.jsx)("button",{className:"btn btn-square btn-xs btn-error tooltip tooltip-bottom","data-tip":"Remove Selected member from list",onMouseDown:e=>{e.stopPropagation();let o=d.filter(e=>!n.has(c(e)));t(d,o)},children:(0,s.jsx)(tS.G,{icon:ny.faDeleteLeft})}),o]})},[d,c,t]);return(0,s.jsx)(nM,{...i,member:d,memberToId:c,slotSelection:u})}let oi=(0,l.memo)(e=>{let{initialValue:t,onCommit:n,onFocus:o,onBlur:i}=e,[a,r]=(0,l.useState)(t||"");return(0,l.useEffect)(()=>{r(t||"")},[t]),(0,s.jsx)("input",{className:"grow",type:"text",placeholder:"role of member",value:a,onChange:e=>r(e.target.value),onKeyDown:e=>{"Enter"===e.key&&e.currentTarget.blur()},onBlur:e=>{i&&i(e),n(a)},onFocus:o})});function oa(e){let{preset:t,existing:n,title:o,onSubmit:i,open:a,onClose:r,createMembers:d}=e,[c,u]=(0,l.useState)({});(0,l.useEffect)(()=>{u(()=>t.tag.reduce((e,t)=>((null==n?void 0:n.some(e=>t["@_k"]===e["@_k"]))||(e[t["@_k"]]=t["@_v"]||""),e),{}))},[n,t]);let m=(0,l.useMemo)(()=>t.tag.filter(e=>!(null==n?void 0:n.some(t=>e["@_k"]===t["@_k"]))),[t,n]),[p,h]=(0,l.useState)((null==n?void 0:n.map(e=>({key:e["@_k"],value:e["@_v"]})))||[]),[f,x]=(0,l.useState)("");(0,l.useEffect)(()=>{let e=document.getElementById("create-node-modal");a?null==e||e.showModal():null==e||e.close()},[a]);let b=(e,t)=>{u(n=>({...n,[e]:t}))},g=(0,l.useCallback)(()=>{""!==f.trim()&&(h(e=>[...e,{key:f.trim(),value:""}]),x(""))},[f]),y=(e,t)=>{h(n=>n.map((n,o)=>o===e?{...n,value:t}:n))},w=e=>{h(t=>t.filter((t,n)=>n!==e))},v=(0,l.useMemo)(()=>(0,s.jsxs)(s.Fragment,{children:[n&&(0,s.jsx)("div",{className:"divider",children:"Needed preset tags"}),m.map(e=>(0,s.jsxs)("label",{className:"input input-bordered input-sm flex items-center gap-x-1 tooltip tooltip-top","data-tip":e.description||"",children:[(0,s.jsxs)("span",{className:"font-semibold",children:[e["@_k"]," ","required"===e.importance&&(0,s.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,s.jsx)("input",{type:"text",placeholder:e.example||"Enter value",value:c[e["@_k"]],onChange:t=>b(e["@_k"],t.target.value),required:"required"===e.importance,disabled:"not-recommened"===e.importance,className:"grow"}),(0,s.jsx)("span",{className:"badge",children:e.importance})]},e["@_k"])),(0,s.jsx)("div",{className:"divider",children:n?"Exsisting or created tags":"Created tags"}),p.map((e,t)=>(0,s.jsxs)("label",{className:"input input-bordered input-sm flex items-center gap-x-1",children:[(0,s.jsxs)("span",{className:"font-semibold",children:[e.key," ",(0,s.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,s.jsx)("input",{type:"text",placeholder:"Enter value",value:e.value,onChange:e=>y(t,e.target.value),required:!0,className:"grow"}),!n&&(0,s.jsx)("span",{className:"badge",children:"created"}),(0,s.jsx)("button",{type:"button",className:"btn btn-xs btn-error",onClick:()=>w(t),children:(0,s.jsx)(tS.G,{icon:tk.$aW})})]},e.key)),(0,s.jsxs)("label",{className:"input input-sm input-bordered flex items-center gap-2",children:[(0,s.jsx)("input",{type:"text",placeholder:"New tag key",value:f,onChange:e=>x(e.target.value),onKeyDown:e=>{"Enter"===e.key&&(e.preventDefault(),g())},className:"grow"}),(0,s.jsx)("button",{type:"button",className:"btn btn-xs btn-outline",onClick:g,children:"+ add tag"})]})]}),[g,n,m,f,p,c]),[_,j]=(0,l.useState)([]),[N,S]=(0,l.useState)(void 0),k=(0,l.useCallback)((e,t,n)=>{console.log("edit",e,t,n),j(o=>o.map(o=>{if(o["@_type"]===e&&o["@_ref"]===t){let e=M(o);return e["@_role"]=n,e}return o}))},[]),E=(0,l.useCallback)(e=>`${e["@_type"]}-${e["@_ref"]}`,[]),C=(0,l.useCallback)(e=>{let{member:t,children:n}=e;return(0,s.jsx)(on,{id:t["@_ref"],type:t["@_type"],children:()=>{let e=(null==N?void 0:N.id)===t["@_ref"]&&N.type===t["@_type"];return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("button",{type:"button",className:T("btn btn-square btn-xs tooltip tooltip-bottom",e&&"btn-accent"),"data-tip":"Mark as local active place to insert",onMouseDown:n=>{n.stopPropagation(),e?S(void 0):S({id:t["@_ref"],type:t["@_type"]})},children:(0,s.jsx)(tS.G,{icon:e?tk.diR:nR.faCircle})}),(0,s.jsxs)("label",{className:"input input-xs input-bordered ml-1 flex items-center gap-1",children:["Role:",(0,s.jsx)(oi,{initialValue:t["@_role"],onCommit:e=>k(t["@_type"],t["@_ref"],e)})]}),n]})}})},[k,N]);function R(){}function O(e){j(()=>e)}let P=e=>e.map(e=>({"@_ref":e.id,"@_type":e.type})),D=(0,l.useCallback)(e=>{console.log("Insert at Top: ",e),j(t=>[...P(e),...t])},[]),A=(0,l.useCallback)(e=>{console.log("Insert at Bottom: ",e),j(t=>[...t,...P(e)])},[]),I=(0,l.useCallback)(e=>{console.log("Insert at Active: ",e),N?j(t=>{let n=[...t],o=n.findIndex(e=>e["@_ref"]===N.id&&e["@_type"]===N.type);return n.splice(o+1,0,...P(e)),n}):A(e)},[A,N]),L=(0,l.useMemo)(()=>d?(0,s.jsxs)("div",{className:"flex flex-row",children:[(0,s.jsx)("div",{className:"bg-base-200",children:(0,s.jsx)(oo,{member:_,memberToId:E,onDragStart:R,onDragEnd:O,onDelete:(e,t)=>{j(()=>t)},children:C})}),(0,s.jsx)("div",{className:"",children:(0,s.jsx)(ng,{handelInsertTop:D,handelIntertBottom:A,handelInsertAtActive:I})})]}):null,[d,I,A,D,_,C,E]);return(0,s.jsx)(s.Fragment,{children:(0,s.jsxs)("dialog",{id:"create-node-modal",className:"modal",onClose:r,children:[(0,s.jsxs)("div",{className:"modal-box w-11/12 max-w-5xl",children:[(0,s.jsx)("h3",{className:"font-bold text-lg mb-2",children:o}),(0,s.jsxs)("form",{onSubmit:e=>{e.preventDefault(),i({tag:[...Object.entries(c).filter(e=>{let[,t]=e;return t.length}).map(e=>{let[t,n]=e;return{"@_k":t,"@_v":n}}),...p.map(e=>({"@_k":e.key,"@_v":e.value}))],member:_}),h([]),x(""),r()},className:"space-y-2",children:[v,L,(0,s.jsxs)("div",{className:"modal-action",children:[(0,s.jsx)("button",{type:"button",className:"btn",onClick:()=>r(),children:"Cancel"}),(0,s.jsx)("button",{type:"submit",className:"btn btn-primary",children:"Submit"})]})]})]}),(0,s.jsx)("form",{method:"dialog",className:"modal-backdrop",children:(0,s.jsx)("button",{children:"close"})})]})})}function or(e){let{show:t,proceed:n,...o}=e;return(0,s.jsx)(oa,{open:t,...o,onClose:()=>n(null),onSubmit:n})}let os=(0,tO.confirmable)(e=>(0,s.jsx)(or,{...e}));os.displayName="CreateFeatureTagConform";let ol={tag:[{"@_k":"highway","@_v":"bus_stop",importance:"required",description:"将该处定义为公交站点。最常用的标签。",example:"bus_stop"},{"@_k":"public_transport","@_v":"platform",importance:"required",description:"用于描述该功能是一个公共交通月台，服务于公共交通路线。用于符合ptv2的标签。",example:"platform"},{"@_k":"name",importance:"required",description:"公交站点的名称。",example:"海口路海游路"},{"@_k":"name:zh",importance:"recommened",description:"公交站点的名称。(中文)",example:"海口路海游路"},{"@_k":"bus",importance:"required",description:"在ptv2中注明这个站点为公交站点。",example:"yes"},{"@_k":"ref",importance:"optional",description:"公交站点的参考代码。（常用于内部定位和维护）",example:"ref=3154"},{"@_k":"local_ref",importance:"recommened",description:"公交站点的参考代码。如果公交站台有大量公交车停靠，每个小站点可有独立 local_ref。",example:"16"},{"@_k":"network",importance:"not-recommened",description:"公交站点的网络。可使用全称或缩写，依据附近线路标注情况确定。",example:"古田公交"},{"@_k":"operator",importance:"not-recommened",description:"在公交站点停靠的公交车的运营公司名称。若多家运营，使用分号（;）分隔。",example:"济阳舜达公共交通有限公司"},{"@_k":"shelter",importance:"recommened",description:"若公交站点提供候车亭则为“yes”，否则为“no”。",example:"no"},{"@_k":"departures_board",importance:"recommened",description:"表明公交站点使用的到站显示屏/牌类型。值可为纸质时刻表、实时显示等；departures_board=no 表示无显示屏/牌。",example:"timetable"},{"@_k":"bench",importance:"recommened",description:"若公交站点提供长凳则为“yes”，否则为“no”。",example:"yes"},{"@_k":"bin",importance:"recommened",description:"若公交站点具备垃圾箱则为“yes”，否则为“no”。",example:"no"},{"@_k":"tactile_paving",importance:"recommened",description:"若公交站点设有视障引导设施（提示视障人士月台边缘）则为“yes”，否则为“no”。",example:"no"},{"@_k":"layer",importance:"optional",description:"适用于多层公交站台。对于非地面公交站点，多层信息是必需的以避免疑问。",example:"-1"},{"@_k":"lit",importance:"recommened",description:"若公交站点夜间亮灯则为“yes”，否则为“no”。",example:"yes"},{"@_k":"surface",importance:"recommened",description:"描述公交车站所在的地面。",example:"concrete"}]},od={tag:[{"@_k":"public_transport","@_v":"stop_position",importance:"required",description:"用于描述该功能是一个公共交通停车点。本标签是用于符合ptv2的标签。",example:"stop_position"},{"@_k":"name",importance:"required",description:"公交站点的名称。具体描述见下文补充说明。",example:"食用菌市场"},{"@_k":"name:zh",importance:"recommened",description:"公交站点的名称(中文)。具体描述见下文补充说明。",example:"食用菌市场"},{"@_k":"bus",importance:"required",description:"在ptv2中注明这个站点为公交站点",example:"yes"}]},oc={tag:[{"@_k":"public_transport","@_v":"stop_area",importance:"required",description:"用于描述该功能是一个停车区关系。本标签是用于符合ptv2的标签。",example:"stop_position"},{"@_k":"name",importance:"required",description:"该站组的名称，使用主名称或推广名称，即指向同一位置的同名分站台合并于此关系中",example:"经十路舜耕路"},{"@_k":"name:zh",importance:"recommened",description:"该站组的名称(中文)，使用主名称或推广名称，即指向同一位置的同名分站台合并于此关系中",example:"经十路舜耕路"},{"@_k":"type",importance:"required",description:"","@_v":"public_transport"}]},ou={tag:[{"@_k":"type","@_v":"route",importance:"required",description:"将该关系定义为一条线路。",example:"route"},{"@_k":"route",importance:"required",description:"将该关系线路设为一条公交/有轨电车线路。(bus/trolleybus)",example:"bus"},{"@_k":"ref","@_v":"*",importance:"required",description:"线路编号，建议使用电显、站牌或公交官网给出的名称；建议在同一城市内，区县公交在前缀中体现区县名称，如：章丘4（未注明）、番1（已注明",example:"番1"},{"@_k":"public_transport:version","@_v":"2",importance:"recommened",description:"此标签对 OSM 交通数据的用户十分有用，此标签可以让用户知道线路是根据新系统 PTv2 添加。此标签可使分析和验证更加容易。",example:"2"},{"@_k":"operator",importance:"recommened",description:"营运该线路公交公司或车队的名称。请使用规范的企业名称；若多家公司共同运营，请在两家公司之间加上“;”。",example:"上海松江公共交通有限公司"},{"@_k":"network",importance:"required",description:"该线路所属的网络，使用该网络关系相同的名称",example:"黔江公交"},{"@_k":"opening_hours",importance:"recommened",description:"公交路线的运营时间，包含首班车和末班车发车时间，登记应使用英文两字母式星期标记，并采用24小时制。",example:"Jan 1-May 31 06:00-21:45; Jun 1-Oct 7 06:00-22:15; Oct 8-Dec 31 06:00-21:45"},{"@_k":"interval",importance:"recommened",description:"公交车途径任意站点到达时的间隔时间，也称为发车间隔。格式可为 HH:MM:SS, H:MM:SS, HH:MM, H:MM, MM 或 M。",example:"00:06:30"},{"@_k":"duration",importance:"recommened",description:"公交线路的持续时间，从发车到抵达终点。格式为 HH:MM:SS, H:MM:SS, HH:MM, H:MM, MM 或 M。",example:"00:31"},{"@_k":"fee",importance:"recommened",description:"如果乘坐该公交需支付费用则为“yes”，选填 charge 说明乘车费用；若无需支付费用则为“no”。",example:"yes+charge=3.00 CNY"},{"@_k":"payment",importance:"recommened",description:"详细列表请见：支付方式，常用的有 payment:cash, payment:coins, payment:ic, payment:unionpay, payment:city_union, payment:china_t-union, payment:e-cny, payment:alipay, payment:wechat, payment:mipay, payment:samsung_pay, payment:huawei_pay, payment:apple_pay。",example:""},{"@_k":"bicycle",importance:"recommened",description:"如果该公交允许携带自行车乘车则为“yes”。",example:"yes"},{"@_k":"wheelchair",importance:"recommened",description:"如果允许使用轮椅的乘客或携带轮椅的乘客上车，请标记为 'yes'；否则标记为 'no'。",example:"yes"},{"@_k":"from",importance:"required",description:"公交车发车方向的位置名称，不一定是公交车站的名称。",example:"通常汽渡"},{"@_k":"via",importance:"optional",description:"在双向环线或起终点名称相同的线路中注明中间站点。",example:"涞寅路绿庭尚城"},{"@_k":"to",importance:"required",description:"公交线路目的地的名称，通常显示在公交车顶部作为终到站。",example:"北官厅"},{"@_k":"name",importance:"required",description:"建议使用格式：<前缀><编号>路: <起点站> => <终点站>，详情参考相关标准。",example:"K37路: 解放桥东 -> 铁厂北路公交车场"},{"@_k":"name:zh",importance:"recommened",description:"建议使用格式：<前缀><编号>路: <起点站> => <终点站>，详情参考相关标准。",example:"K37路: 解放桥东 -> 铁厂北路公交车场"},{"@_k":"official_name",importance:"optional",description:"用于描述官方地图上所用公交路线的名称。大多数线路仅供参考，因此请勿使用此标记。",example:"虹桥枢纽10路区间"},{"@_k":"colour",importance:"optional",description:"官方地图上公交线路的颜色，使用十六进制或 HTML 颜色代码。",example:"#58912F"},{"@_k":"roundtrip",importance:"optional",description:"指定关系是否为环路。对于大多数线路，该值为 'no'.",example:"no"},{"@_k":"description",importance:"optional",description:"其他关于该线路的未尽事宜，可以在此用中文表述，如：春节期间线路有变动、本地公交卡7折优惠",example:"济南公交刷卡标准折扣"}]},om={tag:[{"@_k":"type","@_v":"route_master",importance:"required",description:"将该关系定义为路线主关系",example:"route_master"},{"@_k":"route_master","@_v":"bus",importance:"required",description:"将该线路主关系为一条公交线路主关系",example:"bus"},{"@_k":"ref",importance:"required",description:"线路代码（若无官方代码请使用official_name标签）",example:"金青线"},{"@_k":"name",importance:"required",description:"路线名称，格式：<所在路网><编号>路（例：济南公交K10路支线）",example:"大足公交204路"},{"@_k":"network",importance:"required",description:"所属运输网络名称（需与网络关系一致）",example:"北京公交"},{"@_k":"operator",importance:"recommended",description:"运营公司名称（多家公司用分号分隔）",example:"上海众兴汽车旅游客运有限公司"},{"@_k":"wheelchair",importance:"optional",description:"是否允许轮椅上车（yes/no）",example:"yes"},{"@_k":"bicycle",importance:"optional",description:"是否允许携带自行车（yes/no）",example:"yes"},{"@_k":"official_name",importance:"optional",description:"官方地图显示名称（无正式名称时勿用）",example:"Bull City Connector"},{"@_k":"ref:OPT",importance:"conditional",description:"运营商特定参考号（根据实际情况添加）",example:"OCH"}]};function op(e){let{x:t,y:n,open:o,children:i}=e;return o?(0,s.jsx)("ul",{className:"absolute rounded-lg bg-base-100 menu shadow p-0",onMouseDown:e=>e.stopPropagation(),style:{top:n,left:t},children:l.Children.map(i,(e,t)=>(0,l.isValidElement)(e)?"a"===e.type?(0,s.jsx)("li",{children:e},t):(0,s.jsx)("li",{children:(0,s.jsx)("a",{children:e})},t):null)}):null}let oh=(0,l.memo)(function(e){let t=x((0,tg.N)(S(e))),n=e$(e=>e.createBusStopSel),o=e$(e=>e.createStopAreaSel),i=(0,tO.createConfirmation)(os),a=async()=>{e.onClose();let o=await i({title:"Create Bus stop (Preset CN)",preset:ol});(null==o?void 0:o.tag)&&(console.debug("created bus stop",o),t&&n(t,o.tag))},r=async()=>{e.onClose();let t=await i({title:"Create Stop Area (Preset CN)",preset:oc,createMembers:!0});(null==t?void 0:t.tag)&&o(t.tag,t.member)};return(0,s.jsxs)(op,{...e,children:[(0,s.jsx)("a",{onClick:a,children:"New bus stop"}),(0,s.jsx)("a",{onClick:r,children:"New stop area relation"})]})}),of=(0,l.memo)(function(e){var t,n;let o=x((0,tg.N)(S(e))),i=e$(e=>e.createStopPositionSel),a=e$(e=>e.modifyFeatureMetaNC),r=(0,tO.createConfirmation)(os),l=async()=>{var t;e.onClose();let n=await r({preset:od,title:"Create Stop position (Preset CN)"});(null==n?void 0:n.tag)&&o&&(null===(t=e.feature)||void 0===t?void 0:t.id)&&i(o,n.tag,e.feature.id)},d=async()=>{var t;if(e.onClose(),!(null===(t=e.feature)||void 0===t?void 0:t.id))return;let n=await r({preset:od,existing:e$.getState().meta.node[e.feature.id].tag,title:"Add tags to existing point (Stop position preset CN)"});(null==n?void 0:n.tag)&&a("node",e.feature.id,e=>{e.tag=n.tag})};return(0,s.jsx)(op,{...e,children:(null===(t=e.feature)||void 0===t?void 0:t.type)==="way"?(0,s.jsx)("a",{onClick:l,children:"New stop position"}):(null===(n=e.feature)||void 0===n?void 0:n.type)==="node"?(0,s.jsx)("a",{onClick:d,children:"Set point as stop position"}):(0,s.jsx)("a",{children:"relation is not allowed here"})})}),ox=e=>{let{width:t,height:n}=e,[o,i]=(0,l.useState)({x:0,y:0,open:!1}),[a,r]=(0,l.useState)({x:0,y:0,open:!1}),d=(0,l.useRef)(new ot({meta:e$,view:x,settings:eW},{busStop:i,stopPosition:r})).current;return(0,l.useEffect)(()=>{let e=e=>d.transform(e);return document.addEventListener("keydown",e),()=>document.removeEventListener("keydown",e)},[d]),(0,s.jsxs)("div",{className:"relative",style:{width:t,height:n},children:[(0,s.jsxs)(nG,{width:t,height:n,options:{background:"#1099bb"},onMouseDown:e=>d.transform(e),onPointerMove:e=>d.transform(e),onMouseUp:e=>d.transform(e),onWheel:e=>d.transform(e),children:[(0,s.jsx)(eH,{width:t,height:n}),(0,s.jsx)(tb,{width:t,height:n,stateMachine:d})]}),(0,s.jsx)(nW,{width:t}),(0,s.jsx)(oh,{...o,onClose:()=>i({x:0,y:0,open:!1})}),(0,s.jsx)(of,{...a,onClose:()=>r({x:0,y:0,open:!1})})]})};class ob extends P{transform(e){super.transform(e)}constructor(e){super(e),(0,k._)(this,"idle",void 0),(0,k._)(this,"mapViewSubMachine",void 0),(0,k._)(this,"busStopEditSubMachine",void 0),(0,k._)(this,"undoRedo",void 0),this.idle=new O("pt-edit-idle"),this.mapViewSubMachine=new F(e),this.busStopEditSubMachine=new oe(e,{onRightClick:(e,t)=>{let{routeEdit:n,setRouteStop:o}=this.context.store.meta.getState(),i=t=>t["@_ref"]===e.id&&t["@_type"]===e.type;o(n.stops.some(i)&&!t.ctrlKey?n.stops.filter(e=>!i(e)):[...n.stops,{"@_ref":e.id,"@_type":e.type}])},onLeftClick:(e,t)=>{let{toggleFeature:n}=this.context.store.meta.getState();n(e.type,e.id,!t.shiftKey)},hoverable:e=>"node"===e.type,clickable:e=>"node"===e.type,dragable:()=>!1,selectable:()=>!1}),this.undoRedo=new U(e),this.entry=this.idle,this.current=this.idle,this.accept=[this.idle],this.idle.appendNext(this.mapViewSubMachine,{isEpsilon:!0}),this.idle.appendNext(this.busStopEditSubMachine,{isEpsilon:!0}),this.idle.appendNext(this.undoRedo,{isEpsilon:!0}),this.mapViewSubMachine.appendNext(this.idle,{isEpsilon:!0}),this.busStopEditSubMachine.appendNext(this.idle,{isEpsilon:!0}),this.undoRedo.appendNext(this.idle,{isEpsilon:!0})}}var og=n(2228);class oy extends P{transform(e){super.transform(e)}constructor(e){super(e),(0,k._)(this,"manualAddPathMode",void 0),(0,k._)(this,"mpView",void 0),(0,k._)(this,"mpComponent",void 0),(0,k._)(this,"mpUndoRedo",void 0),this.manualAddPathMode=new O("path-add-manual-mode"),this.entry=this.manualAddPathMode,this.current=this.manualAddPathMode,this.accept=[this.manualAddPathMode],this.mpView=new F(e),this.mpComponent=new oe(e,{onRightClick:(e,t)=>{console.debug(`Add path: right click at ${e}`);let{routeEdit:n,setRoutePath:o}=this.context.store.meta.getState(),i=t=>t["@_ref"]===e.id&&t["@_type"]===e.type;o(n.path.some(i)&&!t.ctrlKey?n.path.filter(e=>!i(e)):[...n.path,{"@_ref":e.id,"@_type":e.type}])},onLeftClick:e=>{let{toggleFeature:t}=this.context.store.meta.getState();t(e.type,e.id,!0)},hoverable:e=>"way"===e.type||"node"===e.type,clickable:e=>"way"===e.type||"node"===e.type,dragable:()=>!1,selectable:()=>!1}),this.mpUndoRedo=new U(e),this.manualAddPathMode.appendNext(this.mpComponent,{isEpsilon:!0}),this.manualAddPathMode.appendNext(this.mpView,{isEpsilon:!0}),this.manualAddPathMode.appendNext(this.mpUndoRedo,{isEpsilon:!0}),this.mpView.appendNext(this.manualAddPathMode,{isEpsilon:!0}),this.mpComponent.appendNext(this.manualAddPathMode,{isEpsilon:!0}),this.mpUndoRedo.appendNext(this.manualAddPathMode,{isEpsilon:!0})}}class ow extends P{transform(e){"mousedown"===e.type&&this.menus.wayEditMenu({x:0,y:0,open:!1}),super.transform(e)}constructor(e,t){super(e),(0,k._)(this,"menus",void 0),(0,k._)(this,"idle",void 0),(0,k._)(this,"mapViewSubMachine",void 0),(0,k._)(this,"componentSubMachine",void 0),(0,k._)(this,"undoRedo",void 0),(0,k._)(this,"batchSelect",void 0),this.menus=t,this.idle=new O("route-edit-idle"),this.mapViewSubMachine=new F(e),this.componentSubMachine=new oe(e,{onRightClick:(e,n)=>{t.wayEditMenu({...D(n.clientX,n.clientY,this.context),open:!0,feature:e})},onLeftClick:(e,t)=>{if("node"===e.type||"way"===e.type){let{toggleFeature:n}=this.context.store.meta.getState();n(e.type,e.id,!t.shiftKey)}},hoverable:e=>"way"===e.type||"node"===e.type,clickable:e=>"way"===e.type||"node"===e.type,dragable:e=>"node"===e.type,selectable:()=>!1}),this.undoRedo=new U(e),this.batchSelect=new n6(e,{onSelectRect:(e,t)=>{let{viewpoint:n,zoom:o,width:i,height:a}=this.context.store.view.getState(),r=N(n,o,i,a,e),s=this.context.store.meta.getState(),l=t3(r)(s);t.ctrlKey||s.clearSelect(),Object.entries(l.node).forEach(e=>{let[,t]=e;return s.selectFeature("node",t["@_id"],!1)})}}),this.entry=this.idle,this.current=this.idle,this.accept=[this.idle],this.idle.appendNext(this.mapViewSubMachine,{isEpsilon:!0}),this.idle.appendNext(this.componentSubMachine,{isEpsilon:!0}),this.idle.appendNext(this.undoRedo,{isEpsilon:!0}),this.idle.appendNext(this.batchSelect,{isEpsilon:!0}),this.mapViewSubMachine.appendNext(this.idle,{isEpsilon:!0}),this.componentSubMachine.appendNext(this.idle,{isEpsilon:!0}),this.undoRedo.appendNext(this.idle,{isEpsilon:!0}),this.batchSelect.appendNext(this.idle,{isEpsilon:!0})}}var ov=n(9865),o_=n(389),oj=new WeakSet;class oN extends P{clearDrawMode(){this.context.store.view.getState().clearDrawModeNC()}transform(e){if("pointermove"===e.type){let t=(0,ov._)(this,oj,oS).call(this,e);console.debug("drawMode pointermove",t),this.context.store.view.getState().setCurPosNC(t)}super.transform(e)}constructor(e){super(e),(0,o_._)(this,oj),(0,k._)(this,"drawMode",void 0),(0,k._)(this,"onMouseDown",void 0),(0,k._)(this,"component",void 0),(0,k._)(this,"undoRedo",void 0),this.drawMode=new O("draw-mode-entry"),this.onMouseDown=new O("draw-mode-mousedown"),this.entry=this.drawMode,this.current=this.drawMode,this.accept=[this.drawMode],this.context.store.view.getState().clearDrawModeNC(),this.context.status=0;let t=(0,ov._)(this,oj,oS).bind(this);this.component=new oe(e,{onLeftClick:(e,n)=>{let{setFromPosNC:o,clearDrawModeNC:i}=this.context.store.view.getState(),{createNodeOnWay:a,createLocalWay:r,modifyFeatureMetaNC:s,meta:l,tree:d}=this.context.store.meta.getState(),c=t(n);if("way"===e.type){let d=l.way[e.id];switch(this.context.status){case 0:this.context.preNode=a(c,[],d["@_id"]),this.context.status=1,o(c);break;case 1:{let e=a(t(n),[],d["@_id"]);r([{"@_ref":this.context.preNode},{"@_ref":e}]),this.context.preNode=void 0,this.context.curWay=void 0,this.context.status=0,i()}break;case 2:{let e=a(t(n),[],d["@_id"]);s("way",this.context.curWay,t=>{t.nd[0]["@_ref"]===this.context.preNode?t.nd=[{"@_ref":e},...t.nd]:t.nd.push({"@_ref":e})}),this.context.preNode=void 0,this.context.curWay=void 0,this.context.status=0,i()}break;default:throw Error(`Unknown state ${this.context.status}`)}}else if("node"===e.type)switch(this.context.status){case 0:if(1==d.elems.node[e.id].fathers.way.length){let t=d.elems.node[e.id].fathers.way[0],n=l.way[t];n.nd[0]["@_ref"]===e.id||n.nd[n.nd.length-1]["@_ref"]===e.id?(this.context.curWay=t,this.context.preNode=e.id,this.context.status=2):(this.context.preNode=e.id,this.context.status=1)}else this.context.preNode=e.id,this.context.status=1;break;case 1:r([{"@_ref":this.context.preNode},{"@_ref":e.id}]),this.context.preNode=void 0,this.context.curWay=void 0,this.context.status=0,i();break;case 2:s("way",this.context.curWay,t=>{t.nd[0]["@_ref"]===this.context.preNode?t.nd=[{"@_ref":e.id},...t.nd]:t.nd.push({"@_ref":e.id})}),this.context.preNode=void 0,this.context.curWay=void 0,this.context.status=0,i();break;default:throw Error(`Unknown state ${this.context.status}`)}},hoverable:e=>"way"===e.type||"node"===e.type,clickable:e=>"way"===e.type||"node"===e.type,dragable:()=>!1,selectable:()=>!1}),this.undoRedo=new U(e),this.drawMode.appendNext(this.component,{isEpsilon:!0}),this.drawMode.appendNext(this.undoRedo,{isEpsilon:!0}),this.drawMode.appendNext(this.drawMode,{transform:e=>{if("mousedown"===e.type&&!(null==e?void 0:e.componentTarget)){let n=t(e),{setFromPosNC:o}=this.context.store.view.getState(),{createLocalNode:i,createLocalWay:a,modifyFeatureMetaNC:r}=this.context.store.meta.getState();switch(this.context.status){case 0:{let e=i(n);o(n),this.context.status=1,this.context.preNode=e,this.context.curWay=void 0}break;case 1:{let e=i(n),t=a([{"@_ref":this.context.preNode},{"@_ref":e}]);o(n),this.context.status=2,this.context.preNode=e,this.context.curWay=t}break;case 2:{let e=i(n);r("way",this.context.curWay,t=>{t.nd[0]["@_ref"]===this.context.preNode?t.nd=[{"@_ref":e},...t.nd]:t.nd.push({"@_ref":e})}),o(n),this.context.status=2,this.context.preNode=e}break;default:throw Error(`Unknown state ${this.context.status}`)}}return!1}}),this.component.appendNext(this.drawMode,{isEpsilon:!0}),this.undoRedo.appendNext(this.drawMode,{isEpsilon:!0})}}function oS(e){return S(D(e.clientX,e.clientY,this.context))(this.context.store.view.getState())}let ok=()=>{let e=e$(e=>e.createEditRoute),t=e$(e=>e.setEditRoute),n=e$(e=>e.cancelEditRoute),o=e$(e=>e.routeEdit.editing),i=e$(e=>e.meta.relation)||{},a=(0,tO.createConfirmation)(os),r=async()=>{let t=await a({title:"Create Bus stop (Preset CN)",preset:ou});(null==t?void 0:t.tag)&&(console.debug("created route",t),e(t.tag,t.member))},d=e=>{t(e)};if((0,l.useEffect)(()=>{let e=new U({meta:e$,view:x,settings:eW}),t=t=>e.transform(t);return document.addEventListener("keydown",t),()=>document.removeEventListener("keydown",t)},[]),o&&i[o]){let e=i[o],t=td(e.tag)||"[no name]";return(0,s.jsxs)("div",{className:"bg-base-100 max-w-xl h-full mx-auto py-4",children:["Selected Route:",(0,s.jsx)("div",{className:"flex flex-row gap-2 text-base items-center",children:(0,s.jsx)(tM,{featuretype:"relation",fullname:t,id:e["@_id"],created:0>Number(e["@_id"]),modified:"modify"===e["@_action"],deleted:"delete"===e["@_action"],children:(0,s.jsx)("button",{onClick:n,className:"btn btn-error btn-square btn-sm",children:(0,s.jsx)(tS.G,{icon:tk.Kl4})})})}),"Please jump to step 2"]})}return(0,s.jsx)("div",{className:"bg-base-100 max-w-xl h-full mx-auto",children:(0,s.jsxs)("div",{className:"card-body",children:[(0,s.jsx)("h2",{className:"card-title text-lg mb-4",children:"Create or Select Route"}),(0,s.jsxs)("button",{className:"btn btn-primary w-full mb-6",onClick:r,children:["Create New Route",(0,s.jsx)(tS.G,{icon:tk.r8p,className:"h-5 w-5 ml-2"})]}),(0,s.jsx)("div",{className:"divider mb-4",children:"OR"}),(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsx)("h3",{className:"font-medium text-base",children:"Existing Routes"}),0===Object.keys(i).length?(0,s.jsxs)("div",{className:"alert alert-info",children:[(0,s.jsx)(tS.G,{icon:tk.eHv,className:"stroke-current shrink-0 h-6 w-6"}),(0,s.jsx)("span",{children:"No routes available"})]}):(0,s.jsx)("div",{className:"h-full overflow-y-auto",children:Object.values(i).filter(e=>tL(e.tag)).map(e=>{let t=td(e.tag)||"[no name]";return(0,s.jsx)("div",{className:"flex items-center px-4 py-2 gap-2 text-sm bg-white rounded hover:bg-base-300",children:(0,s.jsx)(tM,{featuretype:"relation",fullname:t,id:e["@_id"],created:0>Number(e["@_id"]),modified:"modify"===e["@_action"],deleted:"delete"===e["@_action"],children:(0,s.jsx)("button",{onClick:()=>d(e["@_id"]),className:"btn btn-primary btn-square btn-sm",children:(0,s.jsx)(tS.G,{icon:tk.r8p})})})},e["@_id"])})})]})]})})},oM=()=>{let{stops:e}=e$(e=>e.routeEdit),t=e$(e=>e.modifyFeatureStateBatchNC);return(0,l.useEffect)(()=>{let n=e$.getState().meta,o=e.filter(e=>n[e["@_type"]][e["@_ref"]]);return t(o.map(e=>({type:e["@_type"],id:e["@_ref"],modify:e=>{e.highlighted=!0}}))),()=>{t(o.map(e=>({type:e["@_type"],id:e["@_ref"],modify:e=>{e.highlighted=!1}})))}},[t,e]),null},oE=()=>{let[e,t]=(0,l.useState)(!0),{stops:n}=e$(e=>e.routeEdit),o=e$(e=>e.setRouteStop),i=(0,l.useCallback)((e,t,i)=>{console.debug("edit",e,t,i),o(n.map(n=>{if(n["@_type"]===e&&n["@_ref"]===t){let e=M(n);return e["@_role"]=i,e}return n}))},[o,n]),a=(0,l.useCallback)(e=>{let{member:t,children:n}=e;return(0,s.jsx)(nm,{id:t["@_ref"],type:t["@_type"],children:()=>(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("label",{className:"input input-xs input-bordered ml-1 flex items-center gap-1",children:["Role:",(0,s.jsx)(nP,{initialValue:t["@_role"],onCommit:e=>i(t["@_type"],t["@_ref"],e)})]}),n]})})},[i]);return(0,s.jsxs)("div",{className:"absolute top-0 right-0 card min-h-16 max-h-full overflow-auto p-2 bg-base-100 min-w-96",children:[(0,s.jsxs)("div",{className:"flex justify-between items-center",children:[(0,s.jsx)("h3",{children:"Bus stops members (click to show/hide)"}),(0,s.jsx)("button",{onClick:()=>t(!e),className:"btn btn-sm btn-ghost btn-circle","aria-label":e?"Collapse":"Expand",children:(0,s.jsx)(tS.G,{icon:e?og.faChevronUp:tW.faChevronDown,className:"w-4 h-4"})})]}),e&&(0,s.jsx)(nC,{member:n,memberToId:e=>`${e["@_type"]}-${e["@_ref"]}`,onDelete:(e,t)=>o(t),onDragStart:()=>{},onDragEnd:e=>o(e),children:a}),(0,s.jsx)(oM,{})]})},oC=()=>{let{path:e}=e$(e=>e.routeEdit),t=e$(e=>e.modifyFeatureStateBatchNC);return(0,l.useEffect)(()=>{let n=e$.getState().meta,o=e.filter(e=>n[e["@_type"]][e["@_ref"]]);return t(o.map(e=>({type:e["@_type"],id:e["@_ref"],modify:e=>{e.highlighted=!0}}))),()=>{t(o.map(e=>({type:e["@_type"],id:e["@_ref"],modify:e=>{e.highlighted=!1}})))}},[t,e]),null},oR=()=>{let[e,t]=(0,l.useState)(!0),{path:n}=e$(e=>e.routeEdit),o=e$(e=>e.setRoutePath),i=(0,l.useCallback)((e,t,i)=>{console.debug("edit",e,t,i),o(n.map(n=>{if(n["@_type"]===e&&n["@_ref"]===t){let e=M(n);return e["@_role"]=i,e}return n}))},[o,n]),a=(0,l.useCallback)(e=>{let{member:t,children:o,index:a,overlay:r}=e;return(0,s.jsx)(nm,{id:t["@_ref"],type:t["@_type"],children:()=>(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("div",{className:"w-3",children:!r&&(0,s.jsx)(nF,{member:n,index:a})}),(0,s.jsxs)("label",{className:"input input-xs input-bordered ml-1 flex items-center gap-1",children:["Role:",(0,s.jsx)(nP,{initialValue:t["@_role"],onCommit:e=>i(t["@_type"],t["@_ref"],e)})]}),o]})})},[i,n]);return(0,s.jsxs)("div",{className:"absolute top-0 right-0 card min-h-16 max-h-full overflow-auto p-2 bg-base-100 min-w-96",children:[(0,s.jsxs)("div",{className:"flex justify-between items-center",children:[(0,s.jsx)("h3",{children:"Path members (click to show/hide)"}),(0,s.jsx)("button",{onClick:()=>t(!e),className:"btn btn-sm btn-ghost btn-circle","aria-label":e?"Collapse":"Expand",children:(0,s.jsx)(tS.G,{icon:e?og.faChevronUp:tW.faChevronDown,className:"w-4 h-4"})})]}),e&&(0,s.jsx)(nC,{member:n,memberToId:e=>`${e["@_type"]}-${e["@_ref"]}`,onDelete:(e,t)=>o(t),onDragStart:()=>{},onDragEnd:e=>o(e),children:a}),(0,s.jsx)(oC,{})]})},oT=e=>{let{width:t,height:n}=e,o=(0,l.useRef)(new ob({meta:e$,view:x,settings:eW}));return(0,l.useEffect)(()=>{let e=e=>o.current.transform(e);return document.addEventListener("keydown",e),()=>document.removeEventListener("keydown",e)},[]),(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(nG,{width:t,height:n,options:{background:"#1099bb"},onMouseDown:e=>o.current.transform(e),onPointerMove:e=>o.current.transform(e),onMouseUp:e=>o.current.transform(e),onWheel:e=>o.current.transform(e),children:[(0,s.jsx)(eH,{width:t,height:n}),(0,s.jsx)(tb,{width:t,height:n,stateMachine:o.current})]}),(0,s.jsx)(nW,{width:t}),(0,s.jsx)(oE,{})]})},oO=(0,l.memo)(function(e){var t,n;let o=x((0,tg.N)(S(e))),i=e$(e=>e.splitWay),a=e$(e=>e.createNodeOnWay);return(0,s.jsx)(op,{...e,children:(null===(t=e.feature)||void 0===t?void 0:t.type)==="way"?(0,s.jsx)("a",{onClick:()=>{var t;(null===(t=e.feature)||void 0===t?void 0:t.id)&&o&&a(o,[],e.feature.id),e.onClose()},children:"New point on way"}):(null===(n=e.feature)||void 0===n?void 0:n.type)==="node"?(0,s.jsx)("a",{onClick:()=>{var t;(null===(t=e.feature)||void 0===t?void 0:t.id)&&i(e.feature.id),e.onClose()},children:"Split way by point"}):(0,s.jsx)("a",{children:"relation is not allowed here"})})}),oP=e=>{let{width:t,height:n}=e,o=(0,l.useRef)(new oy({meta:e$,view:x,settings:eW}));return(0,l.useEffect)(()=>{let e=e=>o.current.transform(e);return document.addEventListener("keydown",e),()=>document.removeEventListener("keydown",e)},[]),(0,s.jsxs)("div",{className:"relative",style:{width:t,height:n},children:[(0,s.jsxs)(nG,{width:t,height:n,options:{background:"#1099bb"},onMouseDown:e=>o.current.transform(e),onPointerMove:e=>o.current.transform(e),onMouseUp:e=>o.current.transform(e),onWheel:e=>o.current.transform(e),children:[(0,s.jsx)(eH,{width:t,height:n}),(0,s.jsx)(tb,{width:t,height:n,stateMachine:o.current})]}),(0,s.jsx)(nW,{width:t}),(0,s.jsx)(oR,{})]})},oD=e=>{let{width:t,height:n}=e,[o,i]=(0,l.useState)({x:0,y:0,open:!1}),a=(0,l.useRef)(new ow({meta:e$,view:x,settings:eW},{wayEditMenu:i})).current;return(0,l.useEffect)(()=>{let e=e=>a.transform(e);return document.addEventListener("keydown",e),()=>document.removeEventListener("keydown",e)},[a]),(0,s.jsxs)("div",{className:"relative",style:{width:t,height:n},children:[(0,s.jsxs)(nG,{width:t,height:n,options:{background:"#1099bb"},onMouseDown:e=>a.transform(e),onPointerMove:e=>a.transform(e),onMouseUp:e=>a.transform(e),onWheel:e=>a.transform(e),children:[(0,s.jsx)(eH,{width:t,height:n}),(0,s.jsx)(tb,{width:t,height:n,stateMachine:a})]}),(0,s.jsx)(nW,{width:t}),(0,s.jsx)(oO,{...o,onClose:()=>i({x:0,y:0,open:!1})})]})},oA=e=>{let{width:t,height:n}=e,[o,i]=(0,l.useState)({x:0,y:0,open:!1}),a=(0,l.useRef)(new oN({meta:e$,view:x,settings:eW})).current;return(0,l.useEffect)(()=>{let e=e=>a.transform(e);return document.addEventListener("keydown",e),()=>{document.removeEventListener("keydown",e),a.clearDrawMode()}},[a]),(0,s.jsxs)("div",{className:"relative",style:{width:t,height:n},children:[(0,s.jsxs)(nG,{width:t,height:n,options:{background:"#1099bb"},onMouseDown:e=>a.transform(e),onPointerMove:e=>a.transform(e),onMouseUp:e=>a.transform(e),onWheel:e=>a.transform(e),children:[(0,s.jsx)(eH,{width:t,height:n}),(0,s.jsx)(tb,{width:t,height:n,stateMachine:a})]}),(0,s.jsx)(nW,{width:t}),(0,s.jsx)(oO,{...o,onClose:()=>i({x:0,y:0,open:!1})})]})},oI=e=>{let{width:t,height:n}=e,[o,i]=(0,l.useState)(0);return(0,s.jsxs)("div",{className:"relative",style:{width:t,height:n},children:[(0,s.jsx)("div",{className:"absolute top-1 left-1 z-10",children:(0,s.jsx)("div",{className:"tabs tabs-boxed gap-1 shadow-md",children:[{label:"Add Path"},{label:"Edit Way"},{label:"Draw Way"}].map((e,t)=>(0,s.jsx)("button",{className:`tab tab-sm ${o===t?"tab-active":""}`,onClick:()=>i(t),children:e.label},t))})}),0===o?(0,s.jsx)(oP,{width:t,height:n}):1===o?(0,s.jsx)(oD,{width:t,height:n}):(0,s.jsx)(oA,{width:t,height:n})]})},oL=()=>{let{editing:e,stops:t,path:n}=e$(e=>e.routeEdit),o=e$(e=>e.saveEditRoute),i=e$(e=>e.modifyFeatureMetaNC),a=e$(e=>e.setEditStepNC),r=e$(t=>e&&t.meta.relation[e]),[d,c]=(0,l.useState)((null==r?void 0:r.tag)||[]),{undo:u}=e$.temporal.getState();return((0,l.useEffect)(()=>{let e=new U({meta:e$,view:x,settings:eW}),t=t=>e.transform(t);return document.addEventListener("keydown",t),()=>document.removeEventListener("keydown",t)},[]),r)?(0,s.jsxs)("div",{className:"p-4 bg-base-100 max-w-xl mx-auto max-h-full overflow-scroll w-full",children:[(0,s.jsx)("h2",{className:"text-lg font-bold mb-4",children:"Finalize Route Edits"}),(0,s.jsxs)("div",{className:"mb-6",children:[(0,s.jsx)("h3",{className:"font-medium mb-2",children:"Route Tags"}),(0,s.jsx)(nc,{tags:d,setTags:c,commitChange:()=>i("relation",r["@_id"],e=>e.tag=d)})]}),(0,s.jsxs)("div",{className:"mb-6",children:[(0,s.jsx)("h3",{className:"font-medium mb-2",children:"Route Members"}),(0,s.jsxs)("div",{className:"bg-base-200 p-2 rounded text-xs",children:[(0,s.jsxs)("div",{className:"mb-4",children:[(0,s.jsx)("h4",{className:"text-sm font-medium mb-2",children:"Stops"}),t.map((e,t)=>(0,s.jsx)(nm,{id:e["@_ref"],type:e["@_type"],showMetaType:!0},`${e["@_type"]}-${e["@_ref"]}-${t}`))]}),(0,s.jsxs)("div",{className:"",children:[(0,s.jsx)("h4",{className:"text-sm font-medium mb-2",children:"Path"}),n.map((e,t)=>(0,s.jsx)(nm,{id:e["@_ref"],type:e["@_type"],showMetaType:!0},`${e["@_type"]}-${e["@_ref"]}-${t}`))]})]})]}),(0,s.jsx)("div",{className:"flex gap-2 justify-end",children:(0,s.jsx)("button",{onClick:()=>{o()},className:"btn btn-primary",children:"Save Changes"})})]}):(0,s.jsxs)("div",{className:"p-4 bg-base-100 max-w-xl mx-auto max-h-full overflow-scroll w-full",children:[(0,s.jsx)("div",{className:"alert alert-success mb-4 mx-auto",children:(0,s.jsx)("span",{children:"✓ Changes have been saved"})}),(0,s.jsxs)("div",{className:"flex gap-2 justify-end",children:[(0,s.jsx)("button",{onClick:()=>u(),className:"btn btn-primary",children:"Undo"}),(0,s.jsx)("button",{onClick:()=>a(0),className:"btn btn-primary",children:"Proceed"})]})]})};function oF(){let{step:e}=e$(e=>e.routeEdit),t=e$(e=>e.setEditStepNC),n=e$(e=>e.routeEdit.editing&&e.meta.relation[e.routeEdit.editing]);return(0,l.useEffect)(()=>{console.debug("change meta step",n,e),n||0==e||t(0)},[n,t,e]),null}let o$=e=>{let{width:t,height:n}=e,{step:o,editing:i}=e$(e=>e.routeEdit),a=e$(e=>e.setEditStepNC),r=e=>{i?a(e):a(0)},d=(0,l.useMemo)(()=>[{label:"Create or select route",component:(0,s.jsx)(ok,{})},{label:"Add bus stops",component:(0,s.jsx)(oT,{width:t,height:n-72})},{label:"Edit route path",component:(0,s.jsx)(oI,{width:t,height:n-72})},{label:"Save changes",component:(0,s.jsx)(oL,{})}],[t,n]);return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(oF,{}),(0,s.jsxs)("div",{style:{width:t,height:n},children:[(0,s.jsx)("div",{className:"relative",style:{width:t,height:n-72},children:d[o].component}),(0,s.jsx)("div",{style:{width:t,height:72},children:(0,s.jsx)("div",{className:"absolute bottom-0 left-0 right-0 flex flex-row pt-[8px] bg-base-200",children:(0,s.jsx)("ul",{className:"steps steps-horizontal mx-auto",children:d.map((e,t)=>{let{label:n}=e;return(0,s.jsx)("li",{onClick:()=>r(t),className:T("step cursor-pointer",t<=o?"step-primary":"",!i&&"disabled"),children:n},t)})})})})]})]})},oB=e=>e.routeEdit.selectedMaster;function oU(e){let{width:t,height:n}=e,o=e$(oB),i=e$(e=>e.setSelectedMaster),a=e$(e=>e.clearSelectedMaster),r=e$(e=>e.meta.relation),d=e$(e=>e.createLocalRelation),c=e$(e=>e.modifyFeatureMetaNC),u=e$(e=>e.commit),m=(0,l.useMemo)(()=>(0,tO.createConfirmation)(os),[]),p=(0,l.useMemo)(()=>Object.values(r).filter(e=>{var t;return null===(t=e.tag)||void 0===t?void 0:t.some(e=>"type"===e["@_k"]&&"route_master"===e["@_v"])}),[r]),h=(0,l.useMemo)(()=>Object.values(r).filter(e=>{var t;return null===(t=e.tag)||void 0===t?void 0:t.some(e=>"type"===e["@_k"]&&"route"===e["@_v"])}),[r]),f=(0,l.useCallback)(async()=>{let e=await m({title:"Create Route Master",preset:om});if(null==e?void 0:e.tag){let t=d([]);c("relation",t,t=>{t.tag=e.tag}),i(t)}},[m,d,c,i]),b=(0,l.useCallback)(e=>{o&&c("relation",o,t=>{t.member.some(t=>t["@_ref"]===e)||t.member.push({"@_type":"relation","@_ref":e,"@_role":"route"})})},[o,c]),g=(0,l.useCallback)(e=>{i(e)},[i]),y=(0,l.useCallback)(()=>{a()},[a]),w=(0,l.useCallback)(e=>{o&&c("relation",o,t=>{t.member=e})},[o,c]),v=(0,l.useCallback)((e,t)=>{o&&c("relation",o,e=>{e.member=t})},[o,c]);return(0,l.useEffect)(()=>{let e=new U({meta:e$,view:x,settings:eW}),t=t=>e.transform(t);return document.addEventListener("keydown",t),()=>document.removeEventListener("keydown",t)},[]),(0,s.jsxs)("div",{className:"p-4 bg-base-100 flex flex-col gap-4",style:{width:t,height:n},children:[(0,s.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,s.jsx)("h2",{className:"text-xl font-bold",children:"Route Masters"}),(0,s.jsxs)("button",{onClick:f,className:"btn btn-primary btn-sm",children:[(0,s.jsx)(tS.G,{icon:tk.r8p,className:"mr-2"}),"New Route Master"]})]}),(0,s.jsxs)("div",{className:"flex gap-4 flex-1 overflow-hidden",children:[(0,s.jsx)("div",{className:"w-1/2 bg-base-200 p-4 rounded-box h-full max-h-full flex flex-col",children:(0,s.jsxs)(tQ,{children:[e=>{let{filter:t}=e;return(0,s.jsx)(tK,{forceOpen:!0,name:"route masters",defaultOpen:!0,children:(0,s.jsx)(tz,{relation:Object.values(p),showMetaType:!0,filter:t,children:e=>{let{meta:t}=e;return(0,s.jsx)("button",{className:"btn btn-ghost btn-xs ml-2 tooltip tooltip-bottom","data-tip":"Select as edting route master",onClick:()=>g(t["@_id"]),children:(0,s.jsx)(tS.G,{icon:tk.r8p})})}})})},e=>{let{filter:t}=e;return(0,s.jsx)(tK,{name:"available-routes",defaultOpen:!0,children:(0,s.jsx)(tz,{relation:Object.values(h),showMetaType:!0,filter:t,children:e=>{let{meta:t}=e;return(0,s.jsx)("button",{onClick:()=>b(t["@_id"]),className:"btn btn-ghost btn-xs ml-2 btn-smtooltip tooltip-bottom","data-tip":"Append to editing",children:(0,s.jsx)(tS.G,{icon:tq.faChevronRight})})}})})}]})}),(0,s.jsx)("div",{className:"overflow-scroll bg-base-200 p-4 rounded-box h-full max-h-full",children:o?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,s.jsx)("h3",{className:"font-bold",children:td(r[o].tag)||"Unnamed Master"}),(0,s.jsx)("button",{onClick:y,className:"btn btn-ghost btn-sm",children:(0,s.jsx)(tS.G,{icon:tk.Kl4})})]}),(0,s.jsx)(nc,{tags:r[o].tag||[],setTags:e=>c("relation",o,t=>{t.tag=e}),commitChange:u}),(0,s.jsxs)("div",{className:"mb-4",children:[(0,s.jsx)("h4",{className:"font-medium mb-2",children:"Member Routes"}),(0,s.jsx)(nC,{member:r[o].member,memberToId:e=>`${e["@_type"]}-${e["@_ref"]}`,onDelete:v,onDragStart:()=>{},onDragEnd:w,children:e=>{let{member:t,children:n}=e;return(0,s.jsx)(nm,{id:t["@_ref"],type:t["@_type"],showMetaType:!0,children:()=>n})}})]})]}):(0,s.jsx)("div",{className:"text-center text-gray-500",children:"Select or create a route master to begin"})})]})]})}function oG(e){let{width:t,height:n,children:o}=e;return(0,s.jsx)("div",{className:"bg-base-100 border-r-2 border-r-base-300 flex flex-col",style:{width:t,height:n,maxWidth:t,maxHeight:n},children:o})}function oW(e){let{width:t,height:n}=e,o=(0,l.useMemo)(()=>[{tooltip:"Bus stop edit tab",icon:(0,s.jsx)(tS.G,{icon:n7.faBusSimple}),stage:()=>(0,s.jsx)(ox,{width:t-42,height:n})},{tooltip:"Route edit tab",icon:(0,s.jsx)(tS.G,{icon:n9.faRoute}),stage:()=>(0,s.jsx)(o$,{width:t-42,height:n})},{tooltip:"Edit bus relation",icon:(0,s.jsx)(tS.G,{icon:n8.faCodeCommit}),stage:()=>(0,s.jsx)(oU,{width:t-42,height:n})}],[t,n]),[i,a]=(0,l.useState)(0);return(0,s.jsxs)("div",{className:"flex flex-row",style:{height:n,width:t,maxHeight:n,maxWidth:t},onContextMenu:e=>e.preventDefault(),children:[(0,s.jsx)(oG,{width:42,height:n,children:o.map((e,t)=>(0,s.jsx)("div",{className:"tooltip tooltip-right mx-auto mt-1","data-tip":e.tooltip,children:(0,s.jsx)("button",{onClick:()=>a(t),className:T("btn btn-ghost btn-square btn-sm",t===i&&"btn-active"),children:e.icon})},t))}),(0,s.jsx)("div",{className:"relative",style:{height:n,width:t-42},children:o[i].stage()})]})}let oq=function(e){let{width:t,height:n}=e;return(0,s.jsxs)(tj,{width:t,height:n,axis:"x",initial:t/4*3,children:[e=>(0,s.jsx)(oW,{...e}),e=>(0,s.jsxs)(tj,{...e,axis:"y",children:[e=>(0,s.jsx)(nl,{...e}),e=>(0,s.jsx)(nB,{...e})]})]})};var oV=n(1903);function oH(e){let{width:t,height:n}=e,o=(0,l.useMemo)(()=>[{title:(0,s.jsx)(tS.G,{icon:oV.faBus}),tooltip:"Public transport edit mode",component:()=>(0,s.jsx)(oq,{width:t,height:n-42})},{title:(0,s.jsx)(tS.G,{icon:n5.faMap}),tooltip:"Map edit mode",component:()=>(0,s.jsx)(nV,{width:t,height:n-42})}],[t,n]),[i,a]=(0,l.useState)(0);return(0,s.jsxs)("div",{style:{width:t,height:n,position:"relative"},children:[(0,s.jsx)(n4,{height:42,leftSlot:(0,s.jsx)(s.Fragment,{children:o.map((e,t)=>(0,s.jsx)("div",{className:"tooltip tooltip-right ml-1","data-tip":e.tooltip,children:(0,s.jsx)("button",{onClick:()=>a(t),className:T("btn btn-ghost btn-square btn-sm",i===t&&"btn-active"),children:e.title})},t))})}),(0,s.jsx)("div",{className:"relative",children:o[i].component()})]})}function oz(){let[{width:e,height:t},n]=(0,l.useState)({width:window.innerWidth,height:window.innerHeight});return(0,l.useEffect)(()=>{let e=()=>{n({width:window.innerWidth,height:window.innerHeight})};return window.addEventListener("resize",e),()=>{window.removeEventListener("resize",e)}}),(0,s.jsx)("div",{className:"wrapper h-screen w-screen overflow-hidden",style:{width:e},children:(0,s.jsx)(oH,{width:e,height:t})})}function oK(){return(0,s.jsx)(oz,{})}let oX=document.getElementById("root");oX?(0,d.createRoot)(oX).render((0,s.jsx)(l.StrictMode,{children:(0,s.jsx)(function(){return(0,s.jsx)(s.Fragment,{children:(0,s.jsx)(oK,{})})},{})})):console.error("Root element not found. Ensure there is an element with the ID 'root' in your HTML.")},8925:function(){}},t={};function n(o){var i=t[o];if(void 0!==i)return i.exports;var a=t[o]={id:o,loaded:!1,exports:{}};return e[o].call(a.exports,a,a.exports,n),a.loaded=!0,a.exports}n.m=e,n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},n.d=(e,t)=>{for(var o in t)n.o(t,o)&&!n.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:t[o]})},(()=>{n.g=(()=>{if("object"==typeof globalThis)return globalThis;try{return this||Function("return this")()}catch(e){if("object"==typeof window)return window}})()})(),n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.nmd=e=>(e.paths=[],e.children||(e.children=[]),e),(()=>{var e=[];n.O=(t,o,i,a)=>{if(o){a=a||0;for(var r=e.length;r>0&&e[r-1][2]>a;r--)e[r]=e[r-1];e[r]=[o,i,a];return}for(var s=1/0,r=0;r<e.length;r++){for(var[o,i,a]=e[r],l=!0,d=0;d<o.length;d++)(!1&a||s>=a)&&Object.keys(n.O).every(e=>n.O[e](o[d]))?o.splice(d--,1):(l=!1,a<s&&(s=a));if(l){e.splice(r--,1);var c=i();void 0!==c&&(t=c)}}return t}})(),n.rv=()=>"1.2.8",(()=>{var e={980:0};n.O.j=t=>0===e[t];var t=(t,o)=>{var i,a,[r,s,l]=o,d=0;if(r.some(t=>0!==e[t])){for(i in s)n.o(s,i)&&(n.m[i]=s[i]);if(l)var c=l(n)}for(t&&t(o);d<r.length;d++)a=r[d],n.o(e,a)&&e[a]&&e[a][0](),e[a]=0;return n.O(c)},o=self.webpackChunkbus_fensi=self.webpackChunkbus_fensi||[];o.forEach(t.bind(null,0)),o.push=t.bind(null,o.push.bind(o))})(),n.ruid="bundler=rspack@1.2.8";var o=n.O(void 0,["544","333","74","642","929","223","474","908"],function(){return n(4637)});o=n.O(o)})();